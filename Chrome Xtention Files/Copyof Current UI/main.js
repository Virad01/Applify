/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=i>>2,u=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[h],n[u],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new r;const h=s<<2|o>>4;if(i.push(h),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class l extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,d.prototype.create)}}class d{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(f,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new l(r,o,n)}}const f=/\{\$([^}]+)}/g;function p(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(g(n)&&g(s)){if(!p(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function g(t){return null!==t&&"object"==typeof t}const m=1e3,y=2,v=144e5,w=.5;function b(t,e=m,n=y){const r=e*Math.pow(n,t),i=Math.round(w*r*(Math.random()-.5)*2);return Math.min(v,r+i)}function E(t){return t&&t._delegate?t._delegate:t}class T{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const _="[DEFAULT]";class I{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:_})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=_){return this.instances.has(t)}getOptions(t=_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===_?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=_){return this.component?this.component.multipleInstances?t:_:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class S{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new I(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const C=[];var A;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(A||(A={}));const D={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},k=A.INFO,N={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},x=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=N[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class R{constructor(t){this.name=t,this._logLevel=k,this._logHandler=x,this._userLogHandler=null,C.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in A))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?D[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...t),this._logHandler(this,A.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...t),this._logHandler(this,A.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,A.INFO,...t),this._logHandler(this,A.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,A.WARN,...t),this._logHandler(this,A.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...t),this._logHandler(this,A.ERROR,...t)}}const O=(t,e)=>e.some((e=>t instanceof e));let L,M;const P=new WeakMap,F=new WeakMap,V=new WeakMap,U=new WeakMap,B=new WeakMap;let j={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return F.get(t);if("objectStoreNames"===e)return t.objectStoreNames||V.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function q(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(z(this),t),$(P.get(this))}:function(...t){return $(e.apply(z(this),t))}:function(t,...n){const r=e.call(z(this),t,...n);return V.set(r,t.sort?t.sort():[t]),$(r)}:(t instanceof IDBTransaction&&function(t){if(F.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));F.set(t,e)}(t),O(t,L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,j):t);var e}function $(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e($(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&P.set(e,t)})).catch((()=>{})),B.set(e,t),e}(t);if(U.has(t))return U.get(t);const e=q(t);return e!==t&&(U.set(t,e),B.set(e,t)),e}const z=t=>B.get(t);function K(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=$(o);return r&&o.addEventListener("upgradeneeded",(t=>{r($(o.result),t.oldVersion,t.newVersion,$(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const G=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],Q=new Map;function W(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Q.get(e))return Q.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=H.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!G.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return Q.set(e,s),s}var X;X=j,j={...X,get:(t,e,n)=>W(t,e)||X.get(t,e,n),has:(t,e)=>!!W(t,e)||X.has(t,e)};class Y{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const J="@firebase/app",Z="0.10.1",tt=new R("@firebase/app"),et="@firebase/app-compat",nt="@firebase/analytics-compat",rt="@firebase/analytics",it="@firebase/app-check-compat",st="@firebase/app-check",ot="@firebase/auth",at="@firebase/auth-compat",ct="@firebase/database",ht="@firebase/database-compat",ut="@firebase/functions",lt="@firebase/functions-compat",dt="@firebase/installations",ft="@firebase/installations-compat",pt="@firebase/messaging",gt="@firebase/messaging-compat",mt="@firebase/performance",yt="@firebase/performance-compat",vt="@firebase/remote-config",wt="@firebase/remote-config-compat",bt="@firebase/storage",Et="@firebase/storage-compat",Tt="@firebase/firestore",_t="@firebase/firestore-compat",It="firebase",St="[DEFAULT]",Ct={[J]:"fire-core",[et]:"fire-core-compat",[rt]:"fire-analytics",[nt]:"fire-analytics-compat",[st]:"fire-app-check",[it]:"fire-app-check-compat",[ot]:"fire-auth",[at]:"fire-auth-compat",[ct]:"fire-rtdb",[ht]:"fire-rtdb-compat",[ut]:"fire-fn",[lt]:"fire-fn-compat",[dt]:"fire-iid",[ft]:"fire-iid-compat",[pt]:"fire-fcm",[gt]:"fire-fcm-compat",[mt]:"fire-perf",[yt]:"fire-perf-compat",[vt]:"fire-rc",[wt]:"fire-rc-compat",[bt]:"fire-gcs",[Et]:"fire-gcs-compat",[Tt]:"fire-fst",[_t]:"fire-fst-compat","fire-js":"fire-js",[It]:"fire-js-all"},At=new Map,Dt=new Map,kt=new Map;function Nt(t,e){try{t.container.addComponent(e)}catch(n){tt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function xt(t){const e=t.name;if(kt.has(e))return tt.debug(`There were multiple attempts to register component ${e}.`),!1;kt.set(e,t);for(const e of At.values())Nt(e,t);for(const e of Dt.values())Nt(e,t);return!0}function Rt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Ot=new d("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Lt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new T("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ot.create("app-deleted",{appName:this._name})}}function Mt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:St,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw Ot.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw Ot.create("no-options");const s=At.get(i);if(s){if(p(n,s.options)&&p(r,s.config))return s;throw Ot.create("duplicate-app",{appName:i})}const a=new S(i);for(const t of kt.values())a.addComponent(t);const c=new Lt(n,r,a);return At.set(i,c),c}function Pt(t=St){const e=At.get(t);if(!e&&t===St&&o())return Mt();if(!e)throw Ot.create("no-app",{appName:t});return e}function Ft(t,e,n){var r;let i=null!==(r=Ct[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void tt.warn(t.join(" "))}xt(new T(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const Vt="firebase-heartbeat-database",Ut=1,Bt="firebase-heartbeat-store";let jt=null;function qt(){return jt||(jt=K(Vt,Ut,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Bt)}catch(t){console.warn(t)}}}).catch((t=>{throw Ot.create("idb-open",{originalErrorMessage:t.message})}))),jt}async function $t(t,e){try{const n=(await qt()).transaction(Bt,"readwrite"),r=n.objectStore(Bt);await r.put(e,zt(t)),await n.done}catch(t){if(t instanceof l)tt.warn(t.message);else{const e=Ot.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}function zt(t){return`${t.name}!${t.options.appId}`}class Kt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ht(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Gt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Gt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),Qt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Qt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Gt(){return(new Date).toISOString().substring(0,10)}class Ht{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!h()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await qt()).transaction(Bt),n=await e.objectStore(Bt).get(zt(t));return await e.done,n}catch(t){if(t instanceof l)tt.warn(t.message);else{const e=Ot.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return $t(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return $t(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Qt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}xt(new T("platform-logger",(t=>new Y(t)),"PRIVATE")),xt(new T("heartbeat",(t=>new Kt(t)),"PRIVATE")),Ft(J,Z,""),Ft(J,Z,"esm2017"),Ft("fire-js",""),Ft("firebase","10.11.0","app");const Wt="@firebase/installations",Xt="0.6.6",Yt=1e4,Jt=`w:${Xt}`,Zt="FIS_v2",te="https://firebaseinstallations.googleapis.com/v1",ee=36e5,ne=new d("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function re(t){return t instanceof l&&t.code.includes("request-failed")}function ie({projectId:t}){return`${te}/projects/${t}/installations`}function se(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function oe(t,e){const n=(await e.json()).error;return ne.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ae({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function ce(t){const e=await t();return e.status>=500&&e.status<600?t():e}function he(t){return new Promise((e=>{setTimeout(e,t)}))}const ue=/^[cdef][\w-]{21}$/,le="";function de(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return ue.test(e)?e:le}catch(t){return le}}function fe(t){return`${t.appName}!${t.appId}`}const pe=new Map;function ge(t,e){const n=fe(t);me(n,e),function(t,e){const n=(!ye&&"BroadcastChannel"in self&&(ye=new BroadcastChannel("[Firebase] FID Change"),ye.onmessage=t=>{me(t.data.key,t.data.fid)}),ye);n&&n.postMessage({key:t,fid:e}),0===pe.size&&ye&&(ye.close(),ye=null)}(n,e)}function me(t,e){const n=pe.get(t);if(n)for(const t of n)t(e)}let ye=null;const ve="firebase-installations-database",we=1,be="firebase-installations-store";let Ee=null;function Te(){return Ee||(Ee=K(ve,we,{upgrade:(t,e)=>{0===e&&t.createObjectStore(be)}})),Ee}async function _e(t,e){const n=fe(t),r=(await Te()).transaction(be,"readwrite"),i=r.objectStore(be),s=await i.get(n);return await i.put(e,n),await r.done,s&&s.fid===e.fid||ge(t,e.fid),e}async function Ie(t){const e=fe(t),n=(await Te()).transaction(be,"readwrite");await n.objectStore(be).delete(e),await n.done}async function Se(t,e){const n=fe(t),r=(await Te()).transaction(be,"readwrite"),i=r.objectStore(be),s=await i.get(n),o=e(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||ge(t,o.fid),o}async function Ce(t){let e;const n=await Se(t.appConfig,(n=>{const r=function(t){return ke(t||{fid:de(),registrationStatus:0})}(n),i=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(ne.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=ie(t),i=ae(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={fid:n,authVersion:Zt,appId:t.appId,sdkVersion:Jt},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await ce((()=>fetch(r,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:se(t.authToken)}}throw await oe("Create Installation",c)}(t,e);return _e(t.appConfig,n)}catch(n){throw re(n)&&409===n.customData.serverCode?await Ie(t.appConfig):await _e(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Ae(t)}:{installationEntry:e}}(t,r);return e=i.registrationPromise,i.installationEntry}));return n.fid===le?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function Ae(t){let e=await De(t.appConfig);for(;1===e.registrationStatus;)await he(100),e=await De(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Ce(t);return n||e}return e}function De(t){return Se(t,(t=>{if(!t)throw ne.create("installation-not-found");return ke(t)}))}function ke(t){return 1===(e=t).registrationStatus&&e.registrationTime+Yt<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Ne({appConfig:t,heartbeatServiceProvider:e},n){const r=function(t,{fid:e}){return`${ie(t)}/${e}/authTokens:generate`}(t,n),i=function(t,{refreshToken:e}){const n=ae(t);return n.append("Authorization",function(t){return`${Zt} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={installation:{sdkVersion:Jt,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await ce((()=>fetch(r,a)));if(c.ok)return se(await c.json());throw await oe("Generate Auth Token",c)}async function xe(t,e=!1){let n;const r=await Se(t.appConfig,(r=>{if(!Oe(r))throw ne.create("not-registered");const i=r.authToken;if(!e&&(2===(s=i).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+ee}(s)))return r;var s;if(1===i.requestStatus)return n=async function(t,e){let n=await Re(t.appConfig);for(;1===n.authToken.requestStatus;)await he(100),n=await Re(t.appConfig);const r=n.authToken;return 0===r.requestStatus?xe(t,e):r}(t,e),r;{if(!navigator.onLine)throw ne.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(r);return n=async function(t,e){try{const n=await Ne(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await _e(t.appConfig,r),n}catch(n){if(!re(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await _e(t.appConfig,n)}else await Ie(t.appConfig);throw n}}(t,e),e}}));return n?await n:r.authToken}function Re(t){return Se(t,(t=>{if(!Oe(t))throw ne.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+Yt<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Oe(t){return void 0!==t&&2===t.registrationStatus}function Le(t){return ne.create("missing-app-config-values",{valueName:t})}const Me="installations";xt(new T(Me,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Le("App Configuration");if(!t.name)throw Le("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Le(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:Rt(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),xt(new T("installations-internal",(t=>{const e=Rt(t.getProvider("app").getImmediate(),Me).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:r}=await Ce(e);return r?r.catch(console.error):xe(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await Ce(t);e&&await e}(n),(await xe(n,e)).token}(e,t)}}),"PRIVATE")),Ft(Wt,Xt),Ft(Wt,Xt,"esm2017");const Pe="analytics",Fe="firebase_id",Ve="origin",Ue=6e4,Be="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",je="https://www.googletagmanager.com/gtag/js",qe=new R("@firebase/analytics"),$e=new d("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function ze(t){if(!t.startsWith(je)){const e=$e.create("invalid-gtag-resource",{gtagURL:t});return qe.warn(e.message),""}return t}function Ke(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Ge=30,He=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Qe(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function We(t,e=He,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw $e.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw $e.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Ye;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Ue),Xe({appId:r,apiKey:i,measurementId:s},o,a,e)}async function Xe(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=He){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener((()=>{clearTimeout(s),r($e.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(r,e)}catch(t){if(a)return qe.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:r}=t,i={method:"GET",headers:Qe(r)},s=Be.replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw $e.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return i.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof l&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(i.deleteThrottleMetadata(o),a)return qe.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const h=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?b(n,i.intervalMillis,Ge):b(n,i.intervalMillis),u={throttleEndTimeMillis:Date.now()+h,backoffCount:n+1};return i.setThrottleMetadata(o,u),qe.debug(`Calling attemptFetch again in ${h} millis`),Xe(t,u,r,i)}}class Ye{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Je,Ze;async function tn(t,e,n,r,i,s,o){var a;const c=We(t);c.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&qe.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>qe.error(t))),e.push(c);const l=async function(){if(!h())return qe.warn($e.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return qe.warn($e.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?r.getId():void 0)),[d,f]=await Promise.all([c,l]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(je)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:ze}),r=document.createElement("script"),i=`${je}?l=${t}&id=${e}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,d.measurementId),Ze&&(i("consent","default",Ze),Ze=void 0),i("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[Ve]="firebase",p.update=!0,null!=f&&(p[Fe]=f),i("config",d.measurementId,p),Je&&(i("set",Je),Je=void 0),d.measurementId}class en{constructor(t){this.app=t}_delete(){return delete nn[this.app.options.appId],Promise.resolve()}}let nn={},rn=[];const sn={};let on,an,cn="dataLayer",hn=!1;function un(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=$e.create("invalid-analytics-context",{errorInfo:e});qe.warn(n.message)}}();const r=t.options.appId;if(!r)throw $e.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw $e.create("no-api-key");qe.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=nn[r])throw $e.create("already-exists",{id:r});if(!hn){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(cn);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,r,i){let s=function(...t){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(t,e,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let t=i.send_to;Array.isArray(t)||(t=[t]);const r=await Ke(n);for(const n of t){const t=r.find((t=>t.measurementId===n)),i=t&&e[t.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(t){qe.error(t)}}(t,e,n,r,i)}else if("config"===i){const[i,o]=s;await async function(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const t=(await Ke(n)).find((t=>t.measurementId===i));t&&await e[t.appId]}}catch(t){qe.error(t)}t("config",i,s)}(t,e,n,r,i,o)}else if("consent"===i){const[e]=s;t("consent","update",e)}else if("get"===i){const[e,n,r]=s;t("get",e,n,r)}else if("set"===i){const[e]=s;t("set",e)}else t(i,...s)}catch(t){qe.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}(nn,rn,sn,cn,"gtag");an=t,on=e,hn=!0}return nn[r]=tn(t,rn,sn,e,on,cn,n),new en(t)}const ln="@firebase/analytics",dn="0.10.2";xt(new T(Pe,((t,{options:e})=>un(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),xt(new T("analytics-internal",(function(t){try{const e=t.getProvider(Pe).getImmediate();return{logEvent:(t,n,r)=>function(t,e,n,r){t=E(t),async function(t,e,n,r,i){if(i&&i.global)t("event",n,r);else{const i=await e;t("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(an,nn[t.app.options.appId],e,n,r).catch((t=>qe.error(t)))}(e,t,n,r)}}catch(t){throw $e.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Ft(ln,dn),Ft(ln,dn,"esm2017");var fn,pn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},gn={},mn=mn||{},yn=pn||self;function vn(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function wn(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var bn="closure_uid_"+(1e9*Math.random()>>>0),En=0;function Tn(t,e,n){return t.call.apply(t.bind,arguments)}function _n(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function In(t,e,n){return(In=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Tn:_n).apply(null,arguments)}function Sn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Cn(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function An(){this.s=this.s,this.o=this.o}An.prototype.s=!1,An.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,bn)&&t[bn]||(t[bn]=++En))},An.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Dn=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function kn(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Nn(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(vn(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function xn(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}xn.prototype.h=function(){this.defaultPrevented=!0};var Rn=function(){if(!yn.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};yn.addEventListener("test",t,e),yn.removeEventListener("test",t,e)}catch(t){}return t}();function On(t){return/^[\s\xa0]*$/.test(t)}function Ln(){var t=yn.navigator;return t&&(t=t.userAgent)?t:""}function Mn(t){return-1!=Ln().indexOf(t)}function Pn(t){return Pn[" "](t),t}Pn[" "]=function(){};var Fn,Vn,Un,Bn=Mn("Opera"),jn=Mn("Trident")||Mn("MSIE"),qn=Mn("Edge"),$n=qn||jn,zn=Mn("Gecko")&&!(-1!=Ln().toLowerCase().indexOf("webkit")&&!Mn("Edge"))&&!(Mn("Trident")||Mn("MSIE"))&&!Mn("Edge"),Kn=-1!=Ln().toLowerCase().indexOf("webkit")&&!Mn("Edge");function Gn(){var t=yn.document;return t?t.documentMode:void 0}t:{var Hn="",Qn=(Vn=Ln(),zn?/rv:([^\);]+)(\)|;)/.exec(Vn):qn?/Edge\/([\d\.]+)/.exec(Vn):jn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Vn):Kn?/WebKit\/(\S+)/.exec(Vn):Bn?/(?:Version)[ \/]?(\S+)/.exec(Vn):void 0);if(Qn&&(Hn=Qn?Qn[1]:""),jn){var Wn=Gn();if(null!=Wn&&Wn>parseFloat(Hn)){Fn=String(Wn);break t}}Fn=Hn}yn.document&&jn?Un=Gn()||parseInt(Fn,10)||void 0:Un=void 0;var Xn=Un;function Yn(t,e){if(xn.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(zn){t:{try{Pn(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Jn[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Yn.$.h.call(this)}}Cn(Yn,xn);var Jn={2:"touch",3:"pen",4:"mouse"};Yn.prototype.h=function(){Yn.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Zn="closure_listenable_"+(1e6*Math.random()|0),tr=0;function er(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++tr,this.fa=this.ia=!1}function nr(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function rr(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function ir(t){const e={};for(const n in t)e[n]=t[n];return e}const sr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function or(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<sr.length;e++)n=sr[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ar(t){this.src=t,this.g={},this.h=0}function cr(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Dn(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(nr(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function hr(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}ar.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=hr(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new er(e,this.src,s,!!r,i)).ia=n,t.push(e)),e};var ur="closure_lm_"+(1e6*Math.random()|0),lr={};function dr(t,e,n,r,i){if(r&&r.once)return pr(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)dr(t,e[s],n,r,i);return null}return n=Er(n),t&&t[Zn]?t.O(e,n,wn(r)?!!r.capture:!!r,i):fr(t,e,n,!1,r,i)}function fr(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=wn(i)?!!i.capture:!!i,a=wr(t);if(a||(t[ur]=a=new ar(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){const t=vr;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Rn||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(yr(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function pr(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)pr(t,e[s],n,r,i);return null}return n=Er(n),t&&t[Zn]?t.P(e,n,wn(r)?!!r.capture:!!r,i):fr(t,e,n,!0,r,i)}function gr(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)gr(t,e[s],n,r,i);else r=wn(r)?!!r.capture:!!r,n=Er(n),t&&t[Zn]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=hr(s=t.g[e],n,r,i))&&(nr(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=wr(t))&&(e=t.g[e.toString()],t=-1,e&&(t=hr(e,n,r,i)),(n=-1<t?e[t]:null)&&mr(n))}function mr(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Zn])cr(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(yr(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=wr(e))?(cr(n,t),0==n.h&&(n.src=null,e[ur]=null)):nr(t)}}}function yr(t){return t in lr?lr[t]:lr[t]="on"+t}function vr(t,e){if(t.fa)t=!0;else{e=new Yn(e,this);var n=t.listener,r=t.la||t.src;t.ia&&mr(t),t=n.call(r,e)}return t}function wr(t){return(t=t[ur])instanceof ar?t:null}var br="__closure_events_fn_"+(1e9*Math.random()>>>0);function Er(t){return"function"==typeof t?t:(t[br]||(t[br]=function(e){return t.handleEvent(e)}),t[br])}function Tr(){An.call(this),this.i=new ar(this),this.S=this,this.J=null}function _r(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new xn(e,t);else if(e instanceof xn)e.target=e.target||t;else{var i=e;or(e=new xn(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=Ir(o,r,!0,e)&&i}if(i=Ir(o=e.g=t,r,!0,e)&&i,i=Ir(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=Ir(o=e.g=n[s],r,!1,e)&&i}function Ir(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&cr(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Cn(Tr,An),Tr.prototype[Zn]=!0,Tr.prototype.removeEventListener=function(t,e,n,r){gr(this,t,e,n,r)},Tr.prototype.N=function(){if(Tr.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)nr(n[r]);delete e.g[t],e.h--}}this.J=null},Tr.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Tr.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Sr=yn.JSON.stringify;function Cr(){var t=Or;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ar=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Dr),(t=>t.reset()));class Dr{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function kr(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Nr(t){yn.setTimeout((()=>{throw t}),0)}let xr,Rr=!1,Or=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ar.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Lr=()=>{const t=yn.Promise.resolve(void 0);xr=()=>{t.then(Mr)}};var Mr=()=>{for(var t;t=Cr();){try{t.h.call(t.g)}catch(t){Nr(t)}var e=Ar;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Rr=!1};function Pr(t,e){Tr.call(this),this.h=t||1,this.g=e||yn,this.j=In(this.qb,this),this.l=Date.now()}function Fr(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Vr(t,e,n){if("function"==typeof t)n&&(t=In(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=In(t.handleEvent,t)}return 2147483647<Number(e)?-1:yn.setTimeout(t,e||0)}function Ur(t){t.g=Vr((()=>{t.g=null,t.i&&(t.i=!1,Ur(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Cn(Pr,Tr),(fn=Pr.prototype).ga=!1,fn.T=null,fn.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),_r(this,"tick"),this.ga&&(Fr(this),this.start()))}},fn.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},fn.N=function(){Pr.$.N.call(this),Fr(this),delete this.g};class Br extends An{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Ur(this)}N(){super.N(),this.g&&(yn.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function jr(t){An.call(this),this.h=t,this.g={}}Cn(jr,An);var qr=[];function $r(t,e,n,r){Array.isArray(n)||(n&&(qr[0]=n.toString()),n=qr);for(var i=0;i<n.length;i++){var s=dr(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function zr(t){rr(t.g,(function(t,e){this.g.hasOwnProperty(e)&&mr(t)}),t),t.g={}}function Kr(){this.g=!0}function Gr(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Sr(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}jr.prototype.N=function(){jr.$.N.call(this),zr(this)},jr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kr.prototype.Ea=function(){this.g=!1},Kr.prototype.info=function(){};var Hr={},Qr=null;function Wr(){return Qr=Qr||new Tr}function Xr(t){xn.call(this,Hr.Ta,t)}function Yr(t){const e=Wr();_r(e,new Xr(e))}function Jr(t,e){xn.call(this,Hr.STAT_EVENT,t),this.stat=e}function Zr(t){const e=Wr();_r(e,new Jr(e,t))}function ti(t,e){xn.call(this,Hr.Ua,t),this.size=e}function ei(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return yn.setTimeout((function(){t()}),e)}Hr.Ta="serverreachability",Cn(Xr,xn),Hr.STAT_EVENT="statevent",Cn(Jr,xn),Hr.Ua="timingevent",Cn(ti,xn);var ni={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ri={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ii(){}function si(t){return t.h||(t.h=t.i())}function oi(){}ii.prototype.h=null;var ai,ci={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function hi(){xn.call(this,"d")}function ui(){xn.call(this,"c")}function li(){}function di(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new jr(this),this.P=pi,t=$n?125:void 0,this.V=new Pr(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new fi}function fi(){this.i=null,this.g="",this.h=!1}Cn(hi,xn),Cn(ui,xn),Cn(li,ii),li.prototype.g=function(){return new XMLHttpRequest},li.prototype.i=function(){return{}},ai=new li;var pi=45e3,gi={},mi={};function yi(t,e,n){t.L=1,t.A=Pi(xi(e)),t.u=n,t.S=!0,vi(t,null)}function vi(t,e){t.G=Date.now(),Ti(t),t.B=xi(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Wi(n.i,"t",r),t.o=0,n=t.l.J,t.h=new fi,t.g=Ws(t.l,n?e:null,!t.u),0<t.O&&(t.M=new Br(In(t.Pa,t,t.g),t.O)),$r(t.U,t.g,"readystatechange",t.nb),e=t.I?ir(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Yr(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var u=h[0];h=h[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function wi(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function bi(t,e,n){let r,i=!0;for(;!t.J&&t.o<n.length;){if(r=Ei(t,n),r==mi){4==e&&(t.s=4,Zr(14),i=!1),Gr(t.j,t.m,null,"[Incomplete Response]");break}if(r==gi){t.s=4,Zr(15),Gr(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Gr(t.j,t.m,r,null),Ai(t,r)}wi(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,Zr(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),js(e),e.M=!0,Zr(11))):(Gr(t.j,t.m,n,"[Invalid Chunked Response]"),Ci(t),Si(t))}function Ei(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?mi:(n=Number(e.substring(n,r)),isNaN(n)?gi:(r+=1)+n>e.length?mi:(e=e.slice(r,r+n),t.o=r+n,e))}function Ti(t){t.Y=Date.now()+t.P,_i(t,t.P)}function _i(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=ei(In(t.lb,t),e)}function Ii(t){t.C&&(yn.clearTimeout(t.C),t.C=null)}function Si(t){0==t.l.H||t.J||zs(t.l,t)}function Ci(t){Ii(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Fr(t.V),zr(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Ai(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||ns(n.i,t)))if(!t.K&&ns(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;$s(n),Os(n)}Bs(n),Zr(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=ei(In(n.ib,n),6e3));if(1>=es(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Gs(n,11)}else if((t.K||n.g==t)&&$s(n),!On(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let h=i[e];if(n.V=h[0],h=h[1],2==n.H)if("c"==h[0]){n.K=h[1],n.pa=h[2];const e=h[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const i=h[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const u=h[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(rs(s,s.h),s.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Mi(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Qs(r,r.J?r.pa:null,r.Y),o.K){is(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Ii(a),Ti(a)),r.g=o}else Us(r);0<n.j.length&&Ms(n)}else"stop"!=h[0]&&"close"!=h[0]||Gs(n,7);else 3==n.H&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?Gs(n,7):Rs(n):"noop"!=h[0]&&n.h&&n.h.Aa(h),n.A=0)}Yr()}catch(t){}}function Di(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(vn(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(vn(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(vn(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}(fn=di.prototype).setTimeout=function(t){this.P=t},fn.nb=function(t){t=t.target;const e=this.M;e&&3==Cs(t)?e.l():this.Pa(t)},fn.Pa=function(t){try{if(t==this.g)t:{const u=Cs(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||$n||this.g&&(this.h.h||this.g.ja()||As(this.g)))){this.J||4!=u||7==e||Yr(),Ii(this);var n=this.g.da();this.ca=n;e:if(wi(this)){var r=As(this.g);t="";var i=r.length,s=4==Cs(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ci(this),Si(this);var o="";break e}this.h.i=new yn.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!On(a)){var h=a;break e}}h=null}if(!(n=h)){this.i=!1,this.s=3,Zr(12),Ci(this),Si(this);break t}Gr(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ai(this,n)}this.S?(bi(this,u,o),$n&&this.i&&3==u&&($r(this.U,this.V,"tick",this.mb),this.V.start())):(Gr(this.j,this.m,o,null),Ai(this,o)),4==u&&Ci(this),this.i&&!this.J&&(4==u?zs(this.l,this):(this.i=!1,Ti(this)))}else(function(t){const e={};t=(t.g&&2<=Cs(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(On(t[r]))continue;var n=kr(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Zr(12)):(this.s=0,Zr(13)),Ci(this),Si(this)}}}catch(t){}},fn.mb=function(){if(this.g){var t=Cs(this.g),e=this.g.ja();this.o<e.length&&(Ii(this),bi(this,t,e),this.i&&4!=t&&Ti(this))}},fn.cancel=function(){this.J=!0,Ci(this)},fn.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(Yr(),Zr(17)),Ci(this),this.s=2,Si(this)):_i(this,this.Y-t)};var ki=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ni(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Ni){this.h=t.h,Ri(this,t.j),this.s=t.s,this.g=t.g,Oi(this,t.m),this.l=t.l;var e=t.i,n=new Ki;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Li(this,n),this.o=t.o}else t&&(e=String(t).match(ki))?(this.h=!1,Ri(this,e[1]||"",!0),this.s=Fi(e[2]||""),this.g=Fi(e[3]||"",!0),Oi(this,e[4]),this.l=Fi(e[5]||"",!0),Li(this,e[6]||"",!0),this.o=Fi(e[7]||"")):(this.h=!1,this.i=new Ki(null,this.h))}function xi(t){return new Ni(t)}function Ri(t,e,n){t.j=n?Fi(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Oi(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Li(t,e,n){e instanceof Ki?(t.i=e,function(t,e){e&&!t.j&&(Gi(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Hi(this,e),Wi(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Vi(e,$i)),t.i=new Ki(e,t.h))}function Mi(t,e,n){t.i.set(e,n)}function Pi(t){return Mi(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Fi(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Vi(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ui),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ui(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ni.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Vi(e,Bi,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Vi(e,Bi,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Vi(n,"/"==n.charAt(0)?qi:ji,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Vi(n,zi)),t.join("")};var Bi=/[#\/\?@]/g,ji=/[#\?:]/g,qi=/[#\?]/g,$i=/[#\?@]/g,zi=/#/g;function Ki(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Gi(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Hi(t,e){Gi(t),e=Xi(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Qi(t,e){return Gi(t),e=Xi(t,e),t.g.has(e)}function Wi(t,e,n){Hi(t,e),0<n.length&&(t.i=null,t.g.set(Xi(t,e),kn(n)),t.h+=n.length)}function Xi(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(fn=Ki.prototype).add=function(t,e){Gi(this),this.i=null,t=Xi(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},fn.forEach=function(t,e){Gi(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},fn.ta=function(){Gi(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},fn.Z=function(t){Gi(this);let e=[];if("string"==typeof t)Qi(this,t)&&(e=e.concat(this.g.get(Xi(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},fn.set=function(t,e){return Gi(this),this.i=null,Qi(this,t=Xi(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},fn.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},fn.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};var Yi=class{constructor(t,e){this.g=t,this.map=e}};function Ji(t){this.l=t||Zi,t=yn.PerformanceNavigationTiming?0<(t=yn.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(yn.g&&yn.g.Ka&&yn.g.Ka()&&yn.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Zi=10;function ts(t){return!!t.h||!!t.g&&t.g.size>=t.j}function es(t){return t.h?1:t.g?t.g.size:0}function ns(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function rs(t,e){t.g?t.g.add(e):t.h=e}function is(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ss(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return kn(t.i)}Ji.prototype.cancel=function(){if(this.i=ss(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var os=class{stringify(t){return yn.JSON.stringify(t,void 0)}parse(t){return yn.JSON.parse(t,void 0)}};function as(){this.g=new os}function cs(t,e,n){const r=n||"";try{Di(t,(function(t,n){let i=t;wn(t)&&(i=Sr(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function hs(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function us(t){this.l=t.ec||null,this.j=t.ob||!1}function ls(t,e){Tr.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=ds,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Cn(us,ii),us.prototype.g=function(){return new ls(this.l,this.j)},us.prototype.i=function(t){return function(){return t}}({}),Cn(ls,Tr);var ds=0;function fs(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function ps(t){t.readyState=4,t.l=null,t.j=null,t.A=null,gs(t)}function gs(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(fn=ls.prototype).open=function(t,e){if(this.readyState!=ds)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,gs(this)},fn.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||yn).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},fn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ps(this)),this.readyState=ds},fn.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,gs(this)),this.g&&(this.readyState=3,gs(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==yn.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;fs(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},fn.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ps(this):gs(this),3==this.readyState&&fs(this)}},fn.Za=function(t){this.g&&(this.response=this.responseText=t,ps(this))},fn.Ya=function(t){this.g&&(this.response=t,ps(this))},fn.ka=function(){this.g&&ps(this)},fn.setRequestHeader=function(t,e){this.v.append(t,e)},fn.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},fn.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(ls.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var ms=yn.JSON.parse;function ys(t){Tr.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=vs,this.L=this.M=!1}Cn(ys,Tr);var vs="",ws=/^https?$/i,bs=["POST","PUT"];function Es(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ts(t),Is(t)}function Ts(t){t.F||(t.F=!0,_r(t,"complete"),_r(t,"error"))}function _s(t){if(t.h&&void 0!==mn&&(!t.C[1]||4!=Cs(t)||2!=t.da()))if(t.v&&4==Cs(t))Vr(t.La,0,t);else if(_r(t,"readystatechange"),4==Cs(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var i=String(t.I).match(ki)[1]||null;!i&&yn.self&&yn.self.location&&(i=yn.self.location.protocol.slice(0,-1)),r=!ws.test(i?i.toLowerCase():"")}n=r}if(n)_r(t,"complete"),_r(t,"success");else{t.m=6;try{var s=2<Cs(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",Ts(t)}}finally{Is(t)}}}function Is(t,e){if(t.g){Ss(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||_r(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Ss(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(yn.clearTimeout(t.A),t.A=null)}function Cs(t){return t.g?t.g.readyState:0}function As(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case vs:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ds(t){let e="";return rr(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function ks(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ds(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Mi(t,e,n))}function Ns(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function xs(t){this.Ga=0,this.j=[],this.l=new Kr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ns("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ns("baseRetryDelayMs",5e3,t),this.hb=Ns("retryDelaySeedMs",1e4,t),this.eb=Ns("forwardChannelMaxRetries",2,t),this.xa=Ns("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Ji(t&&t.concurrentRequestLimit),this.Ja=new as,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Rs(t){if(Ls(t),3==t.H){var e=t.W++,n=xi(t.I);if(Mi(n,"SID",t.K),Mi(n,"RID",e),Mi(n,"TYPE","terminate"),Fs(t,n),(e=new di(t,t.l,e)).L=2,e.A=Pi(xi(n)),n=!1,yn.navigator&&yn.navigator.sendBeacon)try{n=yn.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&yn.Image&&((new Image).src=e.A,n=!0),n||(e.g=Ws(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ti(e)}Hs(t)}function Os(t){t.g&&(js(t),t.g.cancel(),t.g=null)}function Ls(t){Os(t),t.u&&(yn.clearTimeout(t.u),t.u=null),$s(t),t.i.cancel(),t.m&&("number"==typeof t.m&&yn.clearTimeout(t.m),t.m=null)}function Ms(t){if(!ts(t.i)&&!t.m){t.m=!0;var e=t.Na;xr||Lr(),Rr||(xr(),Rr=!0),Or.add(e,t),t.C=0}}function Ps(t,e){var n;n=e?e.m:t.W++;const r=xi(t.I);Mi(r,"SID",t.K),Mi(r,"RID",n),Mi(r,"AID",t.V),Fs(t,r),t.o&&t.s&&ks(r,t.o,t.s),n=new di(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Vs(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),rs(t.i,n),yi(n,r,e)}function Fs(t,e){t.na&&rr(t.na,(function(t,n){Mi(e,n,t)})),t.h&&Di({},(function(t,n){Mi(e,n,t)}))}function Vs(t,e,n){n=Math.min(t.j.length,n);var r=t.h?In(t.h.Va,t.h,t):null;t:{var i=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{cs(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function Us(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;xr||Lr(),Rr||(xr(),Rr=!0),Or.add(e,t),t.A=0}}function Bs(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=ei(In(t.Ma,t),Ks(t,t.A)),t.A++,0))}function js(t){null!=t.B&&(yn.clearTimeout(t.B),t.B=null)}function qs(t){t.g=new di(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=xi(t.wa);Mi(e,"RID","rpc"),Mi(e,"SID",t.K),Mi(e,"AID",t.V),Mi(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Mi(e,"TO",t.qa),Mi(e,"TYPE","xmlhttp"),Fs(t,e),t.o&&t.s&&ks(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Pi(xi(e)),n.u=null,n.S=!0,vi(n,t)}function $s(t){null!=t.v&&(yn.clearTimeout(t.v),t.v=null)}function zs(t,e){var n=null;if(t.g==e){$s(t),js(t),t.g=null;var r=2}else{if(!ns(t.i,e))return;n=e.F,is(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;_r(r=Wr(),new ti(r,n)),Ms(t)}else Us(t);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function(t,e){return!(es(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=ei(In(t.Na,t,e),Ks(t,t.C)),t.C++,0)))}(t,e)||2==r&&Bs(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Gs(t,5);break;case 4:Gs(t,10);break;case 3:Gs(t,6);break;default:Gs(t,2)}}function Ks(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Gs(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=In(t.pb,t);n||(n=new Ni("//www.google.com/images/cleardot.gif"),yn.location&&"http"==yn.location.protocol||Ri(n,"https"),Pi(n)),function(t,e){const n=new Kr;if(yn.Image){const r=new Image;r.onload=Sn(hs,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Sn(hs,n,r,"TestLoadImage: error",!1,e),r.onabort=Sn(hs,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Sn(hs,n,r,"TestLoadImage: timeout",!1,e),yn.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Zr(2);t.H=0,t.h&&t.h.za(e),Hs(t),Ls(t)}function Hs(t){if(t.H=0,t.ma=[],t.h){const e=ss(t.i);0==e.length&&0==t.j.length||(Nn(t.ma,e),Nn(t.ma,t.j),t.i.i.length=0,kn(t.j),t.j.length=0),t.h.ya()}}function Qs(t,e,n){var r=n instanceof Ni?xi(n):new Ni(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Oi(r,r.m);else{var i=yn.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Ni(null);r&&Ri(s,r),e&&(s.g=e),i&&Oi(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&Mi(r,n,e),Mi(r,"VER",t.ra),Fs(t,r),r}function Ws(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new ys(new us({ob:n})):new ys(t.va)).Oa(t.J),e}function Xs(){}function Ys(){if(jn&&!(10<=Number(Xn)))throw Error("Environmental error: no available transport.")}function Js(t,e){Tr.call(this),this.g=new xs(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!On(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!On(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new eo(this)}function Zs(t){hi.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function to(){ui.call(this),this.status=1}function eo(t){this.g=t}function no(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ro(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function io(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}(fn=ys.prototype).Oa=function(t){this.M=t},fn.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ai.g(),this.C=this.u?si(this.u):si(ai),this.g.onreadystatechange=In(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Es(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=yn.FormData&&t instanceof yn.FormData,!(0<=Dn(bs,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ss(this),0<this.B&&((this.L=function(t){return jn&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=In(this.ua,this)):this.A=Vr(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Es(this,t)}},fn.ua=function(){void 0!==mn&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_r(this,"timeout"),this.abort(8))},fn.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,_r(this,"complete"),_r(this,"abort"),Is(this))},fn.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Is(this,!0)),ys.$.N.call(this)},fn.La=function(){this.s||(this.G||this.v||this.l?_s(this):this.kb())},fn.kb=function(){_s(this)},fn.isActive=function(){return!!this.g},fn.da=function(){try{return 2<Cs(this)?this.g.status:-1}catch(t){return-1}},fn.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},fn.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ms(e)}},fn.Ia=function(){return this.m},fn.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(fn=xs.prototype).ra=8,fn.H=1,fn.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new di(this,this.l,t);let s=this.s;if(this.U&&(s?(s=ir(s),or(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Vs(this,i,e),Mi(n=xi(this.I),"RID",t),Mi(n,"CVER",22),this.F&&Mi(n,"X-HTTP-Session-Id",this.F),Fs(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Ds(s)))+"&"+e:this.o&&ks(n,this.o,s)),rs(this.i,i),this.bb&&Mi(n,"TYPE","init"),this.P?(Mi(n,"$req",e),Mi(n,"SID","null"),i.aa=!0,yi(i,n,null)):yi(i,n,e),this.H=2}}else 3==this.H&&(t?Ps(this,t):0==this.j.length||ts(this.i)||Ps(this))},fn.Ma=function(){if(this.u=null,qs(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=ei(In(this.jb,this),t)}},fn.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Zr(10),Os(this),qs(this))},fn.ib=function(){null!=this.v&&(this.v=null,Os(this),Bs(this),Zr(19))},fn.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Zr(2)):(this.l.info("Failed to ping google.com"),Zr(1))},fn.isActive=function(){return!!this.h&&this.h.isActive(this)},(fn=Xs.prototype).Ba=function(){},fn.Aa=function(){},fn.za=function(){},fn.ya=function(){},fn.isActive=function(){return!0},fn.Va=function(){},Ys.prototype.g=function(t,e){return new Js(t,e)},Cn(Js,Tr),Js.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Zr(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Qs(t,null,t.Y),Ms(t)},Js.prototype.close=function(){Rs(this.g)},Js.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Sr(t),t=n);e.j.push(new Yi(e.fb++,t)),3==e.H&&Ms(e)},Js.prototype.N=function(){this.g.h=null,delete this.j,Rs(this.g),delete this.g,Js.$.N.call(this)},Cn(Zs,hi),Cn(to,ui),Cn(eo,Xs),eo.prototype.Ba=function(){_r(this.g,"a")},eo.prototype.Aa=function(t){_r(this.g,new Zs(t))},eo.prototype.za=function(t){_r(this.g,new to)},eo.prototype.ya=function(){_r(this.g,"b")},Cn(no,(function(){this.blockSize=-1})),no.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},no.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=n;)ro(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){ro(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){ro(this,r),i=0;break}}this.h=i,this.i+=e},no.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var so={};function oo(t){return-128<=t&&128>t?function(t,e){var n=so;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new io([0|t],0>t?-1:0)}(t)}(t):new io([0|t],0>t?-1:0)}function ao(t){if(isNaN(t)||!isFinite(t))return ho;if(0>t)return go(ao(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=co;return new io(e,0)}var co=4294967296,ho=oo(0),uo=oo(1),lo=oo(16777216);function fo(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function po(t){return-1==t.h}function go(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new io(n,~t.h).add(uo)}function mo(t,e){return t.add(go(e))}function yo(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function vo(t,e){this.g=t,this.h=e}function wo(t,e){if(fo(e))throw Error("division by zero");if(fo(t))return new vo(ho,ho);if(po(t))return e=wo(go(t),e),new vo(go(e.g),go(e.h));if(po(e))return e=wo(t,go(e)),new vo(go(e.g),e.h);if(30<t.g.length){if(po(t)||po(e))throw Error("slowDivide_ only works with positive integers.");for(var n=uo,r=e;0>=r.X(t);)n=bo(n),r=bo(r);var i=Eo(n,1),s=Eo(r,1);for(r=Eo(r,2),n=Eo(n,2);!fo(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=Eo(r,1),n=Eo(n,1)}return e=mo(t,i.R(e)),new vo(i,e)}for(i=ho;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=ao(n)).R(e);po(o)||0<o.X(t);)o=(s=ao(n-=r)).R(e);fo(s)&&(s=uo),i=i.add(s),t=mo(t,o)}return new vo(i,t)}function bo(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new io(n,t.h)}function Eo(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new io(i,t.h)}(fn=io.prototype).ea=function(){if(po(this))return-go(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:co+r)*e,e*=co}return t},fn.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(fo(this))return"0";if(po(this))return"-"+go(this).toString(t);for(var e=ao(Math.pow(t,6)),n=this,r="";;){var i=wo(n,e).g,s=((0<(n=mo(n,i.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(fo(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},fn.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},fn.X=function(t){return po(t=mo(this,t))?-1:fo(t)?0:1},fn.abs=function(){return po(this)?go(this):this},fn.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&t.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new io(n,-2147483648&n[n.length-1]?-1:0)},fn.R=function(t){if(fo(this)||fo(t))return ho;if(po(this))return po(t)?go(this).R(go(t)):go(go(this).R(t));if(po(t))return go(this.R(go(t)));if(0>this.X(lo)&&0>t.X(lo))return ao(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=t.D(i)>>>16,c=65535&t.D(i);n[2*r+2*i]+=o*c,yo(n,2*r+2*i),n[2*r+2*i+1]+=s*c,yo(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,yo(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,yo(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new io(n,0)},fn.gb=function(t){return wo(this,t).h},fn.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new io(n,this.h&t.h)},fn.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new io(n,this.h|t.h)},fn.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new io(n,this.h^t.h)},Ys.prototype.createWebChannel=Ys.prototype.g,Js.prototype.send=Js.prototype.u,Js.prototype.open=Js.prototype.m,Js.prototype.close=Js.prototype.close,ni.NO_ERROR=0,ni.TIMEOUT=8,ni.HTTP_ERROR=6,ri.COMPLETE="complete",oi.EventType=ci,ci.OPEN="a",ci.CLOSE="b",ci.ERROR="c",ci.MESSAGE="d",Tr.prototype.listen=Tr.prototype.O,ys.prototype.listenOnce=ys.prototype.P,ys.prototype.getLastError=ys.prototype.Sa,ys.prototype.getLastErrorCode=ys.prototype.Ia,ys.prototype.getStatus=ys.prototype.da,ys.prototype.getResponseJson=ys.prototype.Wa,ys.prototype.getResponseText=ys.prototype.ja,ys.prototype.send=ys.prototype.ha,ys.prototype.setWithCredentials=ys.prototype.Oa,no.prototype.digest=no.prototype.l,no.prototype.reset=no.prototype.reset,no.prototype.update=no.prototype.j,io.prototype.add=io.prototype.add,io.prototype.multiply=io.prototype.R,io.prototype.modulo=io.prototype.gb,io.prototype.compare=io.prototype.X,io.prototype.toNumber=io.prototype.ea,io.prototype.toString=io.prototype.toString,io.prototype.getBits=io.prototype.D,io.fromNumber=ao,io.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return go(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=ao(Math.pow(n,8)),i=ho,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=ao(Math.pow(n,o)),i=i.R(o).add(ao(a))):i=(i=i.R(r)).add(ao(a))}return i};var To=gn.createWebChannelTransport=function(){return new Ys},_o=gn.getStatEventTarget=function(){return Wr()},Io=gn.ErrorCode=ni,So=gn.EventType=ri,Co=gn.Event=Hr,Ao=gn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Do=(gn.FetchXmlHttpFactory=us,gn.WebChannel=oi),ko=gn.XhrIo=ys,No=gn.Md5=no,xo=gn.Integer=io;const Ro="@firebase/firestore";class Oo{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Oo.UNAUTHENTICATED=new Oo(null),Oo.GOOGLE_CREDENTIALS=new Oo("google-credentials-uid"),Oo.FIRST_PARTY=new Oo("first-party-uid"),Oo.MOCK_USER=new Oo("mock-user");let Lo="10.11.0";const Mo=new R("@firebase/firestore");function Po(){return Mo.logLevel}function Fo(t,...e){if(Mo.logLevel<=A.DEBUG){const n=e.map(Bo);Mo.debug(`Firestore (${Lo}): ${t}`,...n)}}function Vo(t,...e){if(Mo.logLevel<=A.ERROR){const n=e.map(Bo);Mo.error(`Firestore (${Lo}): ${t}`,...n)}}function Uo(t,...e){if(Mo.logLevel<=A.WARN){const n=e.map(Bo);Mo.warn(`Firestore (${Lo}): ${t}`,...n)}}function Bo(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function jo(t="Unexpected state"){const e=`FIRESTORE (${Lo}) INTERNAL ASSERTION FAILED: `+t;throw Vo(e),new Error(e)}function qo(t,e){t||jo()}function $o(t,e){return t}const zo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ko extends l{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Go{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Ho{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Qo{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Oo.UNAUTHENTICATED)))}shutdown(){}}class Wo{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Xo{constructor(t){this.t=t,this.currentUser=Oo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new Go;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Go,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Fo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Fo("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Go)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Fo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(qo("string"==typeof e.accessToken),new Ho(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return qo(null===t||"string"==typeof t),new Oo(t)}}class Yo{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Oo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Jo{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Yo(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Oo.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Zo{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ta{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Fo("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Fo("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Fo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):Fo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(qo("string"==typeof t.token),this.R=t.token,new Zo(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ea(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class na{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ea(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function ra(t,e){return t<e?-1:t>e?1:0}function ia(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class sa{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ko(zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ko(zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ko(zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ko(zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return sa.fromMillis(Date.now())}static fromDate(t){return sa.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new sa(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ra(this.nanoseconds,t.nanoseconds):ra(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class oa{constructor(t){this.timestamp=t}static fromTimestamp(t){return new oa(t)}static min(){return new oa(new sa(0,0))}static max(){return new oa(new sa(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class aa{constructor(t,e,n){void 0===e?e=0:e>t.length&&jo(),void 0===n?n=t.length-e:n>t.length-e&&jo(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===aa.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof aa?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ca extends aa{construct(t,e,n){return new ca(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Ko(zo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ca(e)}static emptyPath(){return new ca([])}}const ha=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ua extends aa{construct(t,e,n){return new ua(t,e,n)}static isValidIdentifier(t){return ha.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ua.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ua(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Ko(zo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Ko(zo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ko(zo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Ko(zo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ua(e)}static emptyPath(){return new ua([])}}class la{constructor(t){this.path=t}static fromPath(t){return new la(ca.fromString(t))}static fromName(t){return new la(ca.fromString(t).popFirst(5))}static empty(){return new la(ca.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ca.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ca.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new la(new ca(t.slice()))}}function da(t){return new fa(t.readTime,t.key,-1)}class fa{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new fa(oa.min(),la.empty(),-1)}static max(){return new fa(oa.max(),la.empty(),-1)}}function pa(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=la.comparator(t.documentKey,e.documentKey),0!==n?n:ra(t.largestBatchId,e.largestBatchId))}const ga="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ma{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function ya(t){if(t.code!==zo.FAILED_PRECONDITION||t.message!==ga)throw t;Fo("LocalStore","Unexpectedly lost primary lease")}class va{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&jo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new va(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof va?e:va.resolve(e)}catch(t){return va.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):va.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):va.reject(e)}static resolve(t){return new va(((e,n)=>{e(t)}))}static reject(t){return new va(((e,n)=>{n(t)}))}static waitFor(t){return new va(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=va.resolve(!1);for(const n of t)e=e.next((t=>t?va.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new va(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new va(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}class wa{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new Go,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Ta(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=Aa(e.target.error);this.V.reject(new Ta(t,n))}}static open(t,e,n,r){try{return new wa(e,t.transaction(r,n))}catch(t){throw new Ta(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(Fo("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Ia(e)}}class ba{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===ba.S(c())&&Vo("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Fo("SimpleDb","Removing database:",t),Sa(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!h())return!1;if(ba.C())return!0;const t=c(),e=ba.S(t),n=0<e&&e<10,r=ba.v(t),i=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(Fo("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Ta(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Ko(zo.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Ko(zo.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ta(t,r))},r.onupgradeneeded=t=>{Fo("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{Fo("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const i="readonly"===e;let s=0;for(;;){++s;try{this.db=await this.O(t);const e=wa.open(this.db,t,i?"readonly":"readwrite",n),s=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),va.reject(t)))).toPromise();return s.catch((()=>{})),await e.m,s}catch(t){const e=t,n="FirebaseError"!==e.name&&s<3;if(Fo("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ea{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Sa(this.k.delete())}}class Ta extends Ko{constructor(t,e){super(zo.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function _a(t){return"IndexedDbTransactionError"===t.name}class Ia{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Fo("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Fo("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Sa(n)}add(t){return Fo("SimpleDb","ADD",this.store.name,t,t),Sa(this.store.add(t))}get(t){return Sa(this.store.get(t)).next((e=>(void 0===e&&(e=null),Fo("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Fo("SimpleDb","DELETE",this.store.name,t),Sa(this.store.delete(t))}count(){return Fo("SimpleDb","COUNT",this.store.name),Sa(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new va(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new va(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){Fo("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new va(((n,r)=>{e.onerror=t=>{const e=Aa(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new va(((r,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void r();const s=new Ea(i),o=e(i.primaryKey,i.value,s);if(o instanceof va){const t=o.catch((t=>(s.done(),va.reject(t))));n.push(t)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>va.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Sa(t){return new va(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Aa(t.target.error);n(e)}}))}let Ca=!1;function Aa(t){const e=ba.S(c());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Ko("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ca||(Ca=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Da{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function ka(t){return null==t}function Na(t){return 0===t&&1/t==-1/0}Da._e=-1;function xa(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ra(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class Oa{constructor(t,e){this.comparator=t,this.root=e||Ma.EMPTY}insert(t,e){return new Oa(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ma.BLACK,null,null))}remove(t){return new Oa(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ma.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new La(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new La(this.root,t,this.comparator,!1)}getReverseIterator(){return new La(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new La(this.root,t,this.comparator,!0)}}class La{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ma{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ma.RED,this.left=null!=r?r:Ma.EMPTY,this.right=null!=i?i:Ma.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new Ma(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ma.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Ma.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ma.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ma.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw jo();if(this.right.isRed())throw jo();const t=this.left.check();if(t!==this.right.check())throw jo();return t+(this.isRed()?0:1)}}Ma.EMPTY=null,Ma.RED=!0,Ma.BLACK=!1,Ma.EMPTY=new class{constructor(){this.size=0}get key(){throw jo()}get value(){throw jo()}get color(){throw jo()}get left(){throw jo()}get right(){throw jo()}copy(t,e,n,r,i){return this}insert(t,e,n){return new Ma(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Pa{constructor(t){this.comparator=t,this.data=new Oa(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Fa(this.data.getIterator())}getIteratorFrom(t){return new Fa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Pa))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Pa(this.comparator);return e.data=t,e}}class Fa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Va{constructor(t){this.fields=t,t.sort(ua.comparator)}static empty(){return new Va([])}unionWith(t){let e=new Pa(ua.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Va(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ia(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Ua extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ba{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ua("Invalid base64 string: "+t):t}}(t);return new Ba(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ba(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ra(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ba.EMPTY_BYTE_STRING=new Ba("");const ja=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qa(t){if(qo(!!t),"string"==typeof t){let e=0;const n=ja.exec(t);if(qo(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$a(t.seconds),nanos:$a(t.nanos)}}function $a(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function za(t){return"string"==typeof t?Ba.fromBase64String(t):Ba.fromUint8Array(t)}function Ka(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ga(t){const e=t.mapValue.fields.__previous_value__;return Ka(e)?Ga(e):e}function Ha(t){const e=qa(t.mapValue.fields.__local_write_time__.timestampValue);return new sa(e.seconds,e.nanos)}class Qa{constructor(t,e,n,r,i,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Wa{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Wa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Wa&&t.projectId===this.projectId&&t.database===this.database}}const Xa={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Ya(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ka(t)?4:uc(t)?9007199254740991:10:jo()}function Ja(t,e){if(t===e)return!0;const n=Ya(t);if(n!==Ya(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ha(t).isEqual(Ha(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=qa(t.timestampValue),r=qa(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return za(t.bytesValue).isEqual(za(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return $a(t.geoPointValue.latitude)===$a(e.geoPointValue.latitude)&&$a(t.geoPointValue.longitude)===$a(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return $a(t.integerValue)===$a(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=$a(t.doubleValue),r=$a(e.doubleValue);return n===r?Na(n)===Na(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ia(t.arrayValue.values||[],e.arrayValue.values||[],Ja);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(xa(n)!==xa(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Ja(n[t],r[t])))return!1;return!0}(t,e);default:return jo()}}function Za(t,e){return void 0!==(t.values||[]).find((t=>Ja(t,e)))}function tc(t,e){if(t===e)return 0;const n=Ya(t),r=Ya(e);if(n!==r)return ra(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ra(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=$a(t.integerValue||t.doubleValue),r=$a(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ec(t.timestampValue,e.timestampValue);case 4:return ec(Ha(t),Ha(e));case 5:return ra(t.stringValue,e.stringValue);case 6:return function(t,e){const n=za(t),r=za(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ra(n[t],r[t]);if(0!==e)return e}return ra(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ra($a(t.latitude),$a(e.latitude));return 0!==n?n:ra($a(t.longitude),$a(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=tc(n[t],r[t]);if(e)return e}return ra(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Xa.mapValue&&e===Xa.mapValue)return 0;if(t===Xa.mapValue)return 1;if(e===Xa.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=ra(r[t],s[t]);if(0!==e)return e;const o=tc(n[r[t]],i[s[t]]);if(0!==o)return o}return ra(r.length,s.length)}(t.mapValue,e.mapValue);default:throw jo()}}function ec(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ra(t,e);const n=qa(t),r=qa(e),i=ra(n.seconds,r.seconds);return 0!==i?i:ra(n.nanos,r.nanos)}function nc(t){return rc(t)}function rc(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=qa(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return za(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return la.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=rc(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${rc(t.fields[i])}`;return n+"}"}(t.mapValue):jo()}function ic(t){return!!t&&"integerValue"in t}function sc(t){return!!t&&"arrayValue"in t}function oc(t){return!!t&&"nullValue"in t}function ac(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function cc(t){return!!t&&"mapValue"in t}function hc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ra(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=hc(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=hc(t.arrayValue.values[n]);return e}return Object.assign({},t)}function uc(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class lc{constructor(t){this.value=t}static empty(){return new lc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!cc(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=hc(e)}setAll(t){let e=ua.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=hc(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());cc(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ja(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];cc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Ra(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new lc(hc(this.value))}}class dc{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new dc(t,0,oa.min(),oa.min(),oa.min(),lc.empty(),0)}static newFoundDocument(t,e,n,r){return new dc(t,1,e,oa.min(),n,r,0)}static newNoDocument(t,e){return new dc(t,2,e,oa.min(),oa.min(),lc.empty(),0)}static newUnknownDocument(t,e){return new dc(t,3,e,oa.min(),oa.min(),lc.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(oa.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=lc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=lc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=oa.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof dc&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new dc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class fc{constructor(t,e){this.position=t,this.inclusive=e}}function pc(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?la.comparator(la.fromName(o.referenceValue),n.key):tc(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function gc(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ja(t.position[n],e.position[n]))return!1;return!0}class mc{constructor(t,e="asc"){this.field=t,this.dir=e}}function yc(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class vc{}class wc extends vc{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Cc(t,e,n):"array-contains"===e?new Nc(t,n):"in"===e?new xc(t,n):"not-in"===e?new Rc(t,n):"array-contains-any"===e?new Oc(t,n):new wc(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ac(t,n):new Dc(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(tc(e,this.value)):null!==e&&Ya(this.value)===Ya(e)&&this.matchesComparison(tc(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return jo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bc extends vc{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new bc(t,e)}matches(t){return Ec(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Ec(t){return"and"===t.op}function Tc(t){return function(t){for(const e of t.filters)if(e instanceof bc)return!1;return!0}(t)&&Ec(t)}function _c(t){if(t instanceof wc)return t.field.canonicalString()+t.op.toString()+nc(t.value);if(Tc(t))return t.filters.map((t=>_c(t))).join(",");{const e=t.filters.map((t=>_c(t))).join(",");return`${t.op}(${e})`}}function Ic(t,e){return t instanceof wc?function(t,e){return e instanceof wc&&t.op===e.op&&t.field.isEqual(e.field)&&Ja(t.value,e.value)}(t,e):t instanceof bc?function(t,e){return e instanceof bc&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&Ic(n,e.filters[r])),!0)}(t,e):void jo()}function Sc(t){return t instanceof wc?function(t){return`${t.field.canonicalString()} ${t.op} ${nc(t.value)}`}(t):t instanceof bc?function(t){return t.op.toString()+" {"+t.getFilters().map(Sc).join(" ,")+"}"}(t):"Filter"}class Cc extends wc{constructor(t,e,n){super(t,e,n),this.key=la.fromName(n.referenceValue)}matches(t){const e=la.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ac extends wc{constructor(t,e){super(t,"in",e),this.keys=kc(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Dc extends wc{constructor(t,e){super(t,"not-in",e),this.keys=kc(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function kc(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>la.fromName(t.referenceValue)))}class Nc extends wc{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return sc(e)&&Za(e.arrayValue,this.value)}}class xc extends wc{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Za(this.value.arrayValue,e)}}class Rc extends wc{constructor(t,e){super(t,"not-in",e)}matches(t){if(Za(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Za(this.value.arrayValue,e)}}class Oc extends wc{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!sc(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Za(this.value.arrayValue,t)))}}class Lc{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function Mc(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Lc(t,e,n,r,i,s,o)}function Pc(t){const e=$o(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>_c(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),ka(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>nc(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>nc(t))).join(",")),e.ce=t}return e.ce}function Fc(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!yc(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Ic(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!gc(t.startAt,e.startAt)&&gc(t.endAt,e.endAt)}function Vc(t){return la.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Uc{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Bc(t){return new Uc(t)}function jc(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function qc(t){const e=$o(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Pa(ua.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new mc(r,n))})),t.has(ua.keyField().canonicalString())||e.le.push(new mc(ua.keyField(),n))}return e.le}function $c(t){const e=$o(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return Mc(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new mc(t.field,e)}));const n=t.endAt?new fc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new fc(t.startAt.position,t.startAt.inclusive):null;return Mc(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,qc(t))),e.he}function zc(t,e,n){return new Uc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Kc(t,e){return Fc($c(t),$c(e))&&t.limitType===e.limitType}function Gc(t){return`${Pc($c(t))}|lt:${t.limitType}`}function Hc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Sc(t))).join(", ")}]`),ka(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>nc(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>nc(t))).join(",")),`Target(${e})`}($c(t))}; limitType=${t.limitType})`}function Qc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):la.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of qc(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=pc(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,qc(t),e)||t.endAt&&!function(t,e,n){const r=pc(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,qc(t),e))}(t,e)}function Wc(t){return(e,n)=>{let r=!1;for(const i of qc(t)){const t=Xc(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Xc(t,e,n){const r=t.field.isKeyField()?la.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?tc(r,i):jo()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return jo()}}class Yc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ra(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const Jc=new Oa(la.comparator);function Zc(){return Jc}const th=new Oa(la.comparator);function eh(...t){let e=th;for(const n of t)e=e.insert(n.key,n);return e}function nh(t){let e=th;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function rh(){return sh()}function ih(){return sh()}function sh(){return new Yc((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Oa(la.comparator);const oh=new Pa(la.comparator);function ah(...t){let e=oh;for(const n of t)e=e.add(n);return e}const ch=new Pa(ra);class hh{constructor(){this._=void 0}}function uh(t,e,n){return t instanceof dh?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ka(e)&&(e=Ga(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof fh?ph(t,e):t instanceof gh?mh(t,e):function(t,e){const n=function(t,e){return t instanceof yh?function(t){return ic(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),r=vh(n)+vh(t.Ie);return ic(n)&&ic(t.Ie)?function(t){return{integerValue:""+t}}(r):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Na(e)?"-0":e}}(t.serializer,r)}(t,e)}function lh(t,e,n){return t instanceof fh?ph(t,e):t instanceof gh?mh(t,e):n}class dh extends hh{}class fh extends hh{constructor(t){super(),this.elements=t}}function ph(t,e){const n=wh(e);for(const e of t.elements)n.some((t=>Ja(t,e)))||n.push(e);return{arrayValue:{values:n}}}class gh extends hh{constructor(t){super(),this.elements=t}}function mh(t,e){let n=wh(e);for(const e of t.elements)n=n.filter((t=>!Ja(t,e)));return{arrayValue:{values:n}}}class yh extends hh{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function vh(t){return $a(t.integerValue||t.doubleValue)}function wh(t){return sc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class bh{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new bh}static exists(t){return new bh(void 0,t)}static updateTime(t){return new bh(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Eh(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Th{}function _h(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Rh(t.key,bh.none()):new Ah(t.key,t.data,bh.none());{const n=t.data,r=lc.empty();let i=new Pa(ua.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Dh(t.key,r,new Va(i.toArray()),bh.none())}}function Ih(t,e,n){t instanceof Ah?function(t,e,n){const r=t.value.clone(),i=Nh(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Dh?function(t,e,n){if(!Eh(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Nh(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(kh(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Sh(t,e,n,r){return t instanceof Ah?function(t,e,n,r){if(!Eh(t.precondition,e))return n;const i=t.value.clone(),s=xh(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Dh?function(t,e,n,r){if(!Eh(t.precondition,e))return n;const i=xh(t.fieldTransforms,r,e),s=e.data;return s.setAll(kh(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Eh(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Ch(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ia(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof fh&&e instanceof fh||t instanceof gh&&e instanceof gh?ia(t.elements,e.elements,Ja):t instanceof yh&&e instanceof yh?Ja(t.Ie,e.Ie):t instanceof dh&&e instanceof dh}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ah extends Th{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Dh extends Th{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function kh(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Nh(t,e,n){const r=new Map;qo(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,lh(o,a,n[i]))}return r}function xh(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,uh(t,s,e))}return r}class Rh extends Th{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Oh{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Ih(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Sh(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Sh(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ih();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=_h(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(oa.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ah())}isEqual(t){return this.batchId===t.batchId&&ia(this.mutations,t.mutations,((t,e)=>Ch(t,e)))&&ia(this.baseMutations,t.baseMutations,((t,e)=>Ch(t,e)))}}class Lh{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Mh{constructor(t,e){this.count=t,this.unchangedNames=e}}var Ph,Fh;function Vh(t){if(void 0===t)return Vo("GRPC error has no .code"),zo.UNKNOWN;switch(t){case Ph.OK:return zo.OK;case Ph.CANCELLED:return zo.CANCELLED;case Ph.UNKNOWN:return zo.UNKNOWN;case Ph.DEADLINE_EXCEEDED:return zo.DEADLINE_EXCEEDED;case Ph.RESOURCE_EXHAUSTED:return zo.RESOURCE_EXHAUSTED;case Ph.INTERNAL:return zo.INTERNAL;case Ph.UNAVAILABLE:return zo.UNAVAILABLE;case Ph.UNAUTHENTICATED:return zo.UNAUTHENTICATED;case Ph.INVALID_ARGUMENT:return zo.INVALID_ARGUMENT;case Ph.NOT_FOUND:return zo.NOT_FOUND;case Ph.ALREADY_EXISTS:return zo.ALREADY_EXISTS;case Ph.PERMISSION_DENIED:return zo.PERMISSION_DENIED;case Ph.FAILED_PRECONDITION:return zo.FAILED_PRECONDITION;case Ph.ABORTED:return zo.ABORTED;case Ph.OUT_OF_RANGE:return zo.OUT_OF_RANGE;case Ph.UNIMPLEMENTED:return zo.UNIMPLEMENTED;case Ph.DATA_LOSS:return zo.DATA_LOSS;default:return jo()}}(Fh=Ph||(Ph={}))[Fh.OK=0]="OK",Fh[Fh.CANCELLED=1]="CANCELLED",Fh[Fh.UNKNOWN=2]="UNKNOWN",Fh[Fh.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fh[Fh.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fh[Fh.NOT_FOUND=5]="NOT_FOUND",Fh[Fh.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fh[Fh.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fh[Fh.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fh[Fh.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fh[Fh.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fh[Fh.ABORTED=10]="ABORTED",Fh[Fh.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fh[Fh.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fh[Fh.INTERNAL=13]="INTERNAL",Fh[Fh.UNAVAILABLE=14]="UNAVAILABLE",Fh[Fh.DATA_LOSS=15]="DATA_LOSS";const Uh=new xo([4294967295,4294967295],0);function Bh(t){const e=(new TextEncoder).encode(t),n=new No;return n.update(e),new Uint8Array(n.digest())}function jh(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new xo([n,r],0),new xo([i,s],0)]}class qh{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new $h(`Invalid padding: ${e}`);if(n<0)throw new $h(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new $h(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new $h(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=xo.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(xo.fromNumber(n)));return 1===r.compare(Uh)&&(r=new xo([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Bh(t),[n,r]=jh(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new qh(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Te)return;const e=Bh(t),[n,r]=jh(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class $h extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class zh{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Kh.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new zh(oa.min(),r,new Oa(ra),Zc(),ah())}}class Kh{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Kh(n,e,ah(),ah(),ah())}}class Gh{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class Hh{constructor(t,e){this.targetId=t,this.fe=e}}class Qh{constructor(t,e,n=Ba.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Wh{constructor(){this.ge=0,this.pe=Jh(),this.ye=Ba.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=ah(),e=ah(),n=ah();return this.pe.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:jo()}})),new Kh(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=Jh()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,qo(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class Xh{constructor(t){this.Be=t,this.ke=new Map,this.qe=Zc(),this.Qe=Yh(),this.Ke=new Oa(ra)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Le(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:jo()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const i=r.target;if(Vc(i))if(0===n){const t=new la(i.path);this.We(e,t,dc.newNoDocument(t,oa.min()))}else qo(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),i=n?this.et(n,t,r):1;if(0!==i){this.He(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=za(n).toUint8Array()}catch(t){if(t instanceof Ua)return Uo("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new qh(s,r,i)}catch(t){return Uo(t instanceof $h?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Be.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Be.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Vc(i.target)){const e=new la(i.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,dc.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=ah();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new zh(t,e,this.Ke,this.qe,n);return this.qe=Zc(),this.Qe=Yh(),this.Ke=new Oa(ra),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Wh,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Pa(ra),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||Fo("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new Wh),this.Be.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}}function Yh(){return new Oa(la.comparator)}function Jh(){return new Oa(la.comparator)}const Zh={asc:"ASCENDING",desc:"DESCENDING"},tu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eu={and:"AND",or:"OR"};class nu{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ru(t,e){return t.useProto3Json||ka(e)?e:{value:e}}function iu(t){return qo(!!t),oa.fromTimestamp(function(t){const e=qa(t);return new sa(e.seconds,e.nanos)}(t))}function su(t,e){const n=function(t){return new ca(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function ou(t){const e=ca.fromString(t);return qo(Eu(e)),e}function au(t,e){const n=ou(e);if(n.get(1)!==t.databaseId.projectId)throw new Ko(zo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ko(zo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new la(uu(n))}function cu(t,e){return function(t,e){return su(t,e).canonicalString()}(t.databaseId,e)}function hu(t){return new ca(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function uu(t){return qo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function lu(t,e){return{documents:[cu(t,e.path)]}}function du(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=cu(t,i);const s=function(t){if(0!==t.length)return bu(bc.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:vu(t.field),direction:gu(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ru(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:i}}function fu(t){let e=function(t){const e=ou(t);return 4===e.length?ca.emptyPath():uu(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){qo(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=pu(t);return e instanceof bc&&Tc(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new mc(wu(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,ka(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new fc(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new fc(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Uc(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,h)}function pu(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=wu(t.unaryFilter.field);return wc.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=wu(t.unaryFilter.field);return wc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=wu(t.unaryFilter.field);return wc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=wu(t.unaryFilter.field);return wc.create(i,"!=",{nullValue:"NULL_VALUE"});default:return jo()}}(t):void 0!==t.fieldFilter?function(t){return wc.create(wu(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return jo()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return bc.create(t.compositeFilter.filters.map((t=>pu(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return jo()}}(t.compositeFilter.op))}(t):jo()}function gu(t){return Zh[t]}function mu(t){return tu[t]}function yu(t){return eu[t]}function vu(t){return{fieldPath:t.canonicalString()}}function wu(t){return ua.fromServerFormat(t.fieldPath)}function bu(t){return t instanceof wc?function(t){if("=="===t.op){if(ac(t.value))return{unaryFilter:{field:vu(t.field),op:"IS_NAN"}};if(oc(t.value))return{unaryFilter:{field:vu(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ac(t.value))return{unaryFilter:{field:vu(t.field),op:"IS_NOT_NAN"}};if(oc(t.value))return{unaryFilter:{field:vu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vu(t.field),op:mu(t.op),value:t.value}}}(t):t instanceof bc?function(t){const e=t.getFilters().map((t=>bu(t)));return 1===e.length?e[0]:{compositeFilter:{op:yu(t.op),filters:e}}}(t):jo()}function Eu(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Tu{constructor(t,e,n,r,i=oa.min(),s=oa.min(),o=Ba.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Tu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Tu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Tu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Tu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class _u{constructor(t){this.ct=t}}function Iu(t){const e=fu({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?zc(e,e.limit,"L"):e}class Su{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt($a(t.integerValue));else if("doubleValue"in t){const n=$a(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Na(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Et(e,20),"string"==typeof n&&(n=qa(n)),e.At(`${n.seconds||""}`),e.dt(n.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(za(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?uc(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):jo()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),la.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}Su.bt=new Su;class Cu{constructor(){this._n=new Au}addToCollectionParentIndex(t,e){return this._n.add(e),va.resolve()}getCollectionParents(t,e){return va.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return va.resolve()}deleteFieldIndex(t,e){return va.resolve()}deleteAllFieldIndexes(t){return va.resolve()}createTargetIndexes(t,e){return va.resolve()}getDocumentsMatchingTarget(t,e){return va.resolve(null)}getIndexType(t,e){return va.resolve(0)}getFieldIndexes(t,e){return va.resolve([])}getNextCollectionGroupToUpdate(t){return va.resolve(null)}getMinOffset(t,e){return va.resolve(fa.min())}getMinOffsetFromCollectionGroup(t,e){return va.resolve(fa.min())}updateCollectionGroup(t,e,n){return va.resolve()}updateIndexEntries(t,e){return va.resolve()}}class Au{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Pa(ca.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Pa(ca.comparator)).toArray()}}new Uint8Array(0);class Du{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Du(t,Du.DEFAULT_COLLECTION_PERCENTILE,Du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Du.DEFAULT_COLLECTION_PERCENTILE=10,Du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Du.DEFAULT=new Du(41943040,Du.DEFAULT_COLLECTION_PERCENTILE,Du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Du.DISABLED=new Du(-1,0,0);class ku{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new ku(0)}static Ln(){return new ku(-1)}}class Nu{constructor(){this.changes=new Yc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,dc.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?va.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class xu{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ru{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Sh(n.mutation,t,Va.empty(),sa.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ah()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ah()){const r=rh();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=eh();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=rh();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ah())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=Zc();const s=sh(),o=sh();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Dh)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Sh(o.mutation,e,o.mutation.getFieldMask(),sa.now())):s.set(e.key,Va.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new xu(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=sh();let r=new Oa(((t,e)=>t-e)),i=ah();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Va.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||ah()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,h=ih();c.forEach((t=>{if(!i.has(t)){const r=_h(e.get(t),n.get(t));null!==r&&h.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,h))}return va.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return la.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):va.resolve(rh());let o=-1,a=i;return s.next((e=>va.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?va.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,ah()))).next((t=>({batchId:o,changes:nh(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new la(e)).next((t=>{let e=eh();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=eh();return this.indexManager.getCollectionParents(t,i).next((o=>va.forEach(o,(o=>{const a=function(t,e){return new Uc(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,dc.newInvalidDocument(r)))}));let n=eh();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Sh(s.mutation,r,Va.empty(),sa.now()),Qc(e,r)&&(n=n.insert(t,r))})),n}))}}class Ou{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return va.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:iu(t.createTime)}}(e)),va.resolve()}getNamedQuery(t,e){return va.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:Iu(t.bundledQuery),readTime:iu(t.readTime)}}(e)),va.resolve()}}class Lu{constructor(){this.overlays=new Oa(la.comparator),this.hr=new Map}getOverlay(t,e){return va.resolve(this.overlays.get(e))}getOverlays(t,e){const n=rh();return va.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),va.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),va.resolve()}getOverlaysForCollection(t,e,n){const r=rh(),i=e.length+1,s=new la(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return va.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Oa(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=rh(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=rh(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return va.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Lh(e,n));let i=this.hr.get(e);void 0===i&&(i=ah(),this.hr.set(e,i)),this.hr.set(e,i.add(n.key))}}class Mu{constructor(){this.Pr=new Pa(Pu.Ir),this.Tr=new Pa(Pu.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new Pu(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new Pu(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new la(new ca([])),n=new Pu(e,t),r=new Pu(e,t+1),i=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),i.push(t.key)})),i}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new la(new ca([])),n=new Pu(e,t),r=new Pu(e,t+1);let i=ah();return this.Tr.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Pu(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Pu{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return la.comparator(t.key,e.key)||ra(t.pr,e.pr)}static Er(t,e){return ra(t.pr,e.pr)||la.comparator(t.key,e.key)}}class Fu{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new Pa(Pu.Ir)}checkEmpty(t){return va.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Oh(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.wr=this.wr.add(new Pu(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return va.resolve(s)}lookupMutationBatch(t,e){return va.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),i=r<0?0:r;return va.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return va.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return va.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Pu(e,0),r=new Pu(e,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);i.push(e)})),va.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Pa(ra);return e.forEach((t=>{const e=new Pu(t,0),r=new Pu(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),va.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;la.isDocumentKey(i)||(i=i.child(""));const s=new Pu(new la(i),0);let o=new Pa(ra);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),s),va.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){qo(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return va.forEach(e.mutations,(r=>{const i=new Pu(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new Pu(e,0),r=this.wr.firstAfterOrEqual(n);return va.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,va.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Vu{constructor(t){this.vr=t,this.docs=new Oa(la.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return va.resolve(n?n.document.mutableCopy():dc.newInvalidDocument(e))}getEntries(t,e){let n=Zc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():dc.newInvalidDocument(t))})),va.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Zc();const s=e.path,o=new la(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||pa(da(o),n)<=0||(r.has(o.key)||Qc(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return va.resolve(i)}getAllFromCollectionGroup(t,e,n,r){jo()}Fr(t,e){return va.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Uu(this)}getSize(t){return va.resolve(this.size)}}class Uu extends Nu{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),va.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class Bu{constructor(t){this.persistence=t,this.Mr=new Yc((t=>Pc(t)),Fc),this.lastRemoteSnapshotVersion=oa.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Mu,this.targetCount=0,this.Lr=ku.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),va.resolve()}getLastRemoteSnapshotVersion(t){return va.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return va.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),va.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),va.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Lr=new ku(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,va.resolve()}updateTargetData(t,e){return this.qn(e),va.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,va.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),va.waitFor(i).next((()=>r))}getTargetCount(t){return va.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return va.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),va.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),va.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),va.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return va.resolve(n)}containsKey(t,e){return va.resolve(this.Nr.containsKey(e))}}class ju{constructor(t,e){this.Br={},this.overlays={},this.kr=new Da(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Bu(this),this.indexManager=new Cu,this.remoteDocumentCache=function(t){return new Vu(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new _u(e),this.$r=new Ou(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Lu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new Fu(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){Fo("MemoryPersistence","Starting transaction:",t);const r=new qu(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return va.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class qu extends ma{constructor(t){super(),this.currentSequenceNumber=t}}class $u{constructor(t){this.persistence=t,this.zr=new Mu,this.jr=null}static Hr(t){return new $u(t)}get Jr(){if(this.jr)return this.jr;throw jo()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),va.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),va.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),va.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return va.forEach(this.Jr,(n=>{const r=la.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,oa.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return va.or([()=>va.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class zu{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=ah(),r=ah();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new zu(t,e.fromCache,n,r)}}class Ku{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Gu{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var e;const n=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:ba.v(c())>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ji(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Hi(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new Ku;return this.Ji(t,e,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>i.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(Po()<=A.DEBUG&&Fo("QueryEngine","SDK will not create cache indexes for query:",Hc(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),va.resolve()):(Po()<=A.DEBUG&&Fo("QueryEngine","Query:",Hc(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Po()<=A.DEBUG&&Fo("QueryEngine","The SDK decides to create cache indexes for query:",Hc(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,$c(e))):va.resolve())}ji(t,e){if(jc(e))return va.resolve(null);let n=$c(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=zc(e,null,"F"),n=$c(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=ah(...r);return this.zi.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Zi(e,r);return this.Xi(e,s,i,n.readTime)?this.ji(t,zc(e,null,"F")):this.es(t,s,e,n)}))))})))))}Hi(t,e,n,r){return jc(e)||r.isEqual(oa.min())?va.resolve(null):this.zi.getDocuments(t,n).next((i=>{const s=this.Zi(e,i);return this.Xi(e,s,n,r)?va.resolve(null):(Po()<=A.DEBUG&&Fo("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Hc(e)),this.es(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=oa.fromTimestamp(1e9===r?new sa(n+1,0):new sa(n,r));return new fa(i,la.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new Pa(Wc(t));return e.forEach(((e,r)=>{Qc(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(t,e,n){return Po()<=A.DEBUG&&Fo("QueryEngine","Using full collection scan to execute query:",Hc(e)),this.zi.getDocumentsMatchingQuery(t,e,fa.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Hu{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Oa(ra),this.rs=new Yc((t=>Pc(t)),Fc),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ru(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function Qu(t,e){const n=$o(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=ah();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function Wu(t){const e=$o(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}async function Xu(t,e,n){const r=$o(t),i=r.ns.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!_a(t))throw t;Fo("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}function Yu(t,e,n){const r=$o(t);let i=oa.min(),s=ah();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=$o(t),i=r.rs.get(n);return void 0!==i?va.resolve(r.ns.get(i)):r.Qr.getTargetData(e,n)}(r,t,$c(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?i:oa.min(),n?s:ah()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||oa.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:s})))))}class Ju{constructor(){this.activeTargetIds=ch}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Zu{constructor(){this.no=new Ju,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Ju,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class tl{io(t){}shutdown(){}}class el{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Fo("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){Fo("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let nl=null;function rl(){return null===nl?nl=268435456+Math.round(2147483648*Math.random()):nl++,"0x"+nl.toString(16)}const il={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sl{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const ol="WebChannelConnection";class al extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,i){const s=rl(),o=this.bo(t,e.toUriEncodedString());Fo("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(t,o,a,n).then((e=>(Fo("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw Uo("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,i,s){return this.So(t,e,n,r,i)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Lo,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=il[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const i=rl();return new Promise(((s,o)=>{const a=new ko;a.setWithCredentials(!0),a.listenOnce(So.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Io.NO_ERROR:const e=a.getResponseJson();Fo(ol,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case Io.TIMEOUT:Fo(ol,`RPC '${t}' ${i} timed out`),o(new Ko(zo.DEADLINE_EXCEEDED,"Request time out"));break;case Io.HTTP_ERROR:const n=a.getStatus();if(Fo(ol,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(zo).indexOf(e)>=0?e:zo.UNKNOWN}(e.status);o(new Ko(t,e.message))}else o(new Ko(zo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ko(zo.UNAVAILABLE,"Connection failed."));break;default:jo()}}finally{Fo(ol,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(r);Fo(ol,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const r=rl(),i=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=To(),o=_o(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const h=i.join("");Fo(ol,`Creating RPC '${t}' stream ${r}: ${h}`,a);const u=s.createWebChannel(h,a);let l=!1,d=!1;const f=new sl({lo:e=>{d?Fo(ol,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(Fo(ol,`Opening RPC '${t}' stream ${r} transport.`),u.open(),l=!0),Fo(ol,`RPC '${t}' stream ${r} sending:`,e),u.send(e))},ho:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,Do.EventType.OPEN,(()=>{d||Fo(ol,`RPC '${t}' stream ${r} transport opened.`)})),p(u,Do.EventType.CLOSE,(()=>{d||(d=!0,Fo(ol,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),p(u,Do.EventType.ERROR,(e=>{d||(d=!0,Uo(ol,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new Ko(zo.UNAVAILABLE,"The operation could not be completed")))})),p(u,Do.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];qo(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Fo(ol,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Ph[t];if(void 0!==e)return Vh(e)}(e),i=o.message;void 0===n&&(n=zo.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new Ko(n,i)),u.close()}else Fo(ol,`RPC '${t}' stream ${r} received:`,i),f.mo(i)}})),p(o,Co.STAT_EVENT,(e=>{e.stat===Ao.PROXY?Fo(ol,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Ao.NOPROXY&&Fo(ol,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function cl(){return"undefined"!=typeof document?document:null}function hl(t){return new nu(t,!0)}class ul{constructor(t,e,n=1e3,r=1.5,i=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-n);r>0&&Fo("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class ll{constructor(t,e,n,r,i,s,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new ul(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===zo.RESOURCE_EXHAUSTED?(Vo(e.toString()),Vo("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===zo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new Ko(zo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return Fo("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(Fo("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class dl extends ll{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:jo()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(qo(void 0===e||"string"==typeof e),Ba.fromBase64String(e||"")):(qo(void 0===e||e instanceof Buffer||e instanceof Uint8Array),Ba.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?zo.UNKNOWN:Vh(t.code);return new Ko(e,t.message||"")}(o);n=new Qh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=au(t,r.document.name),s=iu(r.document.updateTime),o=r.document.createTime?iu(r.document.createTime):oa.min(),a=new lc({mapValue:{fields:r.document.fields}}),c=dc.newFoundDocument(i,s,o,a),h=r.targetIds||[],u=r.removedTargetIds||[];n=new Gh(h,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=au(t,r.document),s=r.readTime?iu(r.readTime):oa.min(),o=dc.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Gh([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=au(t,r.document),s=r.removedTargetIds||[];n=new Gh([],s,i,null)}else{if(!("filter"in e))return jo();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Mh(r,i),o=t.targetId;n=new Hh(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return oa.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?oa.min():e.readTime?iu(e.readTime):oa.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=hu(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Vc(r)?{documents:lu(t,r)}:{query:du(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const r=ru(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(oa.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const r=ru(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return jo()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=hu(this.serializer),e.removeTarget=t,this.t_(e)}}class fl extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Ko(zo.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(t,su(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ko(zo.UNKNOWN,t.toString())}))}vo(t,e,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(t,su(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ko(zo.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class pl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Vo(e),this.g_=!1):Fo("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class gl{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((t=>{n.enqueueAndForget((async()=>{Il(this)&&(Fo("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=$o(t);e.v_.add(4),await yl(e),e.x_.set("Unknown"),e.v_.delete(4),await ml(e)}(this))}))})),this.x_=new pl(n,r)}}async function ml(t){if(Il(t))for(const e of t.F_)await e(!0)}async function yl(t){for(const e of t.F_)await e(!1)}function vl(t,e){const n=$o(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),_l(n)?Tl(n):xl(n).Jo()&&bl(n,e))}function wl(t,e){const n=$o(t),r=xl(n);n.C_.delete(e),r.Jo()&&El(n,e),0===n.C_.size&&(r.Jo()?r.Xo():Il(n)&&n.x_.set("Unknown"))}function bl(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(oa.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}xl(t).c_(e)}function El(t,e){t.O_.Oe(e),xl(t).l_(e)}function Tl(t){t.O_=new Xh({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),xl(t).start(),t.x_.p_()}function _l(t){return Il(t)&&!xl(t).Ho()&&t.C_.size>0}function Il(t){return 0===$o(t).v_.size}function Sl(t){t.O_=void 0}async function Cl(t){t.C_.forEach(((e,n)=>{bl(t,e)}))}async function Al(t,e){Sl(t),_l(t)?(t.x_.S_(e),Tl(t)):t.x_.set("Unknown")}async function Dl(t,e,n){if(t.x_.set("Online"),e instanceof Qh&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){Fo("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await kl(t,n)}else if(e instanceof Gh?t.O_.$e(e):e instanceof Hh?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(oa.min()))try{const e=await Wu(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.C_.get(r);i&&t.C_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(Ba.EMPTY_BYTE_STRING,r.snapshotVersion)),El(t,e);const i=new Tu(r.target,e,n,r.sequenceNumber);bl(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Fo("RemoteStore","Failed to raise snapshot:",e),await kl(t,e)}}async function kl(t,e,n){if(!_a(e))throw e;t.v_.add(1),await yl(t),t.x_.set("Offline"),n||(n=()=>Wu(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Fo("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await ml(t)}))}async function Nl(t,e){const n=$o(t);n.asyncQueue.verifyOperationInProgress(),Fo("RemoteStore","RemoteStore received new credentials");const r=Il(n);n.v_.add(3),await yl(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await ml(n)}function xl(t){return t.N_||(t.N_=function(t,e,n){const r=$o(t);return r.R_(),new dl(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Cl.bind(null,t),To:Al.bind(null,t),u_:Dl.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),_l(t)?Tl(t):t.x_.set("Unknown")):(await t.N_.stop(),Sl(t))}))),t.N_}class Rl{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Go,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Rl(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ko(zo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ol(t,e){if(Vo("AsyncQueue",`${e}: ${t}`),_a(t))return new Ko(zo.UNAVAILABLE,`${e}: ${t}`);throw t}class Ll{constructor(t){this.comparator=t?(e,n)=>t(e,n)||la.comparator(e.key,n.key):(t,e)=>la.comparator(t.key,e.key),this.keyedMap=eh(),this.sortedSet=new Oa(this.comparator)}static emptySet(t){return new Ll(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Ll))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Ll;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Ml{constructor(){this.B_=new Oa(la.comparator)}track(t){const e=t.doc.key,n=this.B_.get(e);n?0!==t.type&&3===n.type?this.B_=this.B_.insert(e,t):3===t.type&&1!==n.type?this.B_=this.B_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.B_=this.B_.remove(e):1===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):jo():this.B_=this.B_.insert(e,t)}k_(){const t=[];return this.B_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Pl{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Pl(t,e,Ll.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Kc(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Fl{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((t=>t.U_()))}}class Vl{constructor(){this.queries=new Yc((t=>Gc(t)),Kc),this.onlineState="Unknown",this.W_=new Set}}function Ul(t,e){const n=$o(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.Q_)e.z_(t)&&(r=!0);i.q_=t}}r&&jl(n)}function Bl(t,e,n){const r=$o(t),i=r.queries.get(e);if(i)for(const t of i.Q_)t.onError(n);r.queries.delete(e)}function jl(t){t.W_.forEach((t=>{t.next()}))}var ql,$l;($l=ql||(ql={})).j_="default",$l.Cache="cache";class zl{constructor(t,e,n){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Pl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==e;return(!this.options.ta||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Z_(t){if(t.docChanges.length>0)return!0;const e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ea(t){t=Pl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==ql.Cache}}class Kl{constructor(t){this.key=t}}class Gl{constructor(t){this.key=t}}class Hl{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=ah(),this.mutatedKeys=ah(),this.ha=Wc(t),this.Pa=new Ll(this.ha)}get Ia(){return this.ua}Ta(t,e){const n=e?e.Ea:new Ml,r=e?e.Pa:this.Pa;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const h=r.get(t),u=Qc(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.da(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.ha(u,a)>0||c&&this.ha(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Pa:s,Ea:n,Xi:o,mutatedKeys:i}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;const s=t.Ea.k_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jo()}};return n(t)-n(e)}(t.type,e.type)||this.ha(t.doc,e.doc))),this.Aa(n),r=null!=r&&r;const o=e&&!r?this.Ra():[],a=0===this.la.size&&this.current&&!r?1:0,c=a!==this.ca;return this.ca=a,0!==s.length||c?{snapshot:new Pl(this.query,t.Pa,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Ml,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach((t=>this.ua=this.ua.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.ua=this.ua.delete(t))),this.current=t.current)}Ra(){if(!this.current)return[];const t=this.la;this.la=ah(),this.Pa.forEach((t=>{this.ma(t.key)&&(this.la=this.la.add(t.key))}));const e=[];return t.forEach((t=>{this.la.has(t)||e.push(new Gl(t))})),this.la.forEach((n=>{t.has(n)||e.push(new Kl(n))})),e}fa(t){this.ua=t.hs,this.la=ah();const e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return Pl.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class Ql{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Wl{constructor(t){this.key=t,this.pa=!1}}class Xl{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.ya={},this.wa=new Yc((t=>Gc(t)),Kc),this.Sa=new Map,this.ba=new Set,this.Da=new Oa(la.comparator),this.Ca=new Map,this.va=new Mu,this.Fa={},this.Ma=new Map,this.xa=ku.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function Yl(t,e,n=!0){const r=fd(t);let i;const s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=await Zl(r,e,n,!0),i}async function Jl(t,e){const n=fd(t);await Zl(n,e,!0,!1)}async function Zl(t,e,n,r){const i=await function(t,e){const n=$o(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((i=>i?(r=i,va.resolve(r)):n.Qr.allocateTargetId(t).next((i=>(r=new Tu(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(t.localStore,$c(e)),s=i.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=await async function(t,e,n,r,i){t.Na=(e,n,r)=>async function(t,e,n,r){let i=e.view.Ta(n);i.Xi&&(i=await Yu(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ta(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return ad(t,e.targetId,a.Va),a.snapshot}(t,e,n,r);const s=await Yu(t.localStore,e,!0),o=new Hl(e,s.hs),a=o.Ta(s.documents),c=Kh.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),h=o.applyChanges(a,t.isPrimaryClient,c);ad(t,n,h.Va);const u=new Ql(e,n,o);return t.wa.set(e,u),t.Sa.has(n)?t.Sa.get(n).push(e):t.Sa.set(n,[e]),h.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&vl(t.remoteStore,i),a}async function td(t,e,n){const r=$o(t),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter((t=>!Kc(t,e)))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Xu(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&wl(r.remoteStore,i.targetId),sd(r,i.targetId)})).catch(ya)):(sd(r,i.targetId),await Xu(r.localStore,i.targetId,!0))}async function ed(t,e){const n=$o(t),r=n.wa.get(e),i=n.Sa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),wl(n.remoteStore,r.targetId))}async function nd(t,e){const n=$o(t);try{const t=await function(t,e){const n=$o(t),r=e.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,s.addedDocuments,a))));let h=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?h=h.withResumeToken(Ba.EMPTY_BYTE_STRING,oa.min()).withLastLimboFreeSnapshotVersion(oa.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,s)&&o.push(n.Qr.updateTargetData(t,h))}));let a=Zc(),c=ah();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=ah(),i=ah();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Zc();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(oa.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):Fo("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(oa.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return va.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Ca.get(e);r&&(qo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.pa=!0:t.modifiedDocuments.size>0?qo(r.pa):t.removedDocuments.size>0&&(qo(r.pa),r.pa=!1))})),await ud(n,t,e)}catch(t){await ya(t)}}function rd(t,e,n){const r=$o(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.wa.forEach(((n,r)=>{const i=r.view.G_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=$o(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.G_(e)&&(r=!0)})),r&&jl(n)}(r.eventManager,e),t.length&&r.ya.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function id(t,e,n){const r=$o(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Ca.get(e),s=i&&i.key;if(s){let t=new Oa(la.comparator);t=t.insert(s,dc.newNoDocument(s,oa.min()));const n=ah().add(s),i=new zh(oa.min(),new Map,new Oa(ra),t,n);await nd(r,i),r.Da=r.Da.remove(s),r.Ca.delete(e),hd(r)}else await Xu(r.localStore,e,!1).then((()=>sd(r,e,n))).catch(ya)}function sd(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Sa.get(e))t.wa.delete(r),n&&t.ya.La(r,n);t.Sa.delete(e),t.isPrimaryClient&&t.va.Vr(e).forEach((e=>{t.va.containsKey(e)||od(t,e)}))}function od(t,e){t.ba.delete(e.path.canonicalString());const n=t.Da.get(e);null!==n&&(wl(t.remoteStore,n),t.Da=t.Da.remove(e),t.Ca.delete(n),hd(t))}function ad(t,e,n){for(const r of n)r instanceof Kl?(t.va.addReference(r.key,e),cd(t,r)):r instanceof Gl?(Fo("SyncEngine","Document no longer in limbo: "+r.key),t.va.removeReference(r.key,e),t.va.containsKey(r.key)||od(t,r.key)):jo()}function cd(t,e){const n=e.key,r=n.path.canonicalString();t.Da.get(n)||t.ba.has(r)||(Fo("SyncEngine","New document in limbo: "+n),t.ba.add(r),hd(t))}function hd(t){for(;t.ba.size>0&&t.Da.size<t.maxConcurrentLimboResolutions;){const e=t.ba.values().next().value;t.ba.delete(e);const n=new la(ca.fromString(e)),r=t.xa.next();t.Ca.set(r,new Wl(n)),t.Da=t.Da.insert(n,r),vl(t.remoteStore,new Tu($c(Bc(n.path)),r,"TargetPurposeLimboResolution",Da._e))}}async function ud(t,e,n){const r=$o(t),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((t,a)=>{o.push(r.Na(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=zu.Ki(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.ya.u_(i),await async function(t,e){const n=$o(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>va.forEach(e,(e=>va.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>va.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!_a(t))throw t;Fo("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,i)}}}(r.localStore,s))}async function ld(t,e){const n=$o(t);if(!n.currentUser.isEqual(e)){Fo("SyncEngine","User change. New user:",e.toKey());const t=await Qu(n.localStore,e);n.currentUser=e,function(t,e){t.Ma.forEach((t=>{t.forEach((t=>{t.reject(new Ko(zo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ma.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await ud(n,t.us)}}function dd(t,e){const n=$o(t),r=n.Ca.get(e);if(r&&r.pa)return ah().add(r.key);{let t=ah();const r=n.Sa.get(e);if(!r)return t;for(const e of r){const r=n.wa.get(e);t=t.unionWith(r.view.Ia)}return t}}function fd(t){const e=$o(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=nd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dd.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=id.bind(null,e),e.ya.u_=Ul.bind(null,e.eventManager),e.ya.La=Bl.bind(null,e.eventManager),e}class pd{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=hl(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new Hu(t,e,n,r)}(this.persistence,new Gu,t.initialUser,this.serializer)}createPersistence(t){return new ju($u.Hr,this.serializer)}createSharedClientState(t){return new Zu}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class gd{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>rd(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=ld.bind(null,this.syncEngine),await async function(t,e){const n=$o(t);e?(n.v_.delete(2),await ml(n)):e||(n.v_.add(2),await yl(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Vl}createDatastore(t){const e=hl(t.databaseInfo.databaseId),n=function(t){return new al(t)}(t.databaseInfo);return function(t,e,n,r){return new fl(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new gl(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>rd(this.syncEngine,t,0)),el.D()?new el:new tl)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Xl(t,e,n,r,i,s);return o&&(a.Oa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=$o(t);Fo("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await yl(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class md{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):Vo("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class yd{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Oo.UNAUTHENTICATED,this.clientId=na.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Fo("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Fo("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ko(zo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Go;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Ol(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function vd(t,e){t.asyncQueue.verifyOperationInProgress(),Fo("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Qu(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function wd(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Fo("FirestoreClient","Using user provided OfflineComponentProvider");try{await vd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===zo.FAILED_PRECONDITION||t.code===zo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Uo("Error using user provided cache. Falling back to memory cache: "+n),await vd(t,new pd)}}else Fo("FirestoreClient","Using default OfflineComponentProvider"),await vd(t,new pd);return t._offlineComponents}(t);Fo("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Nl(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Nl(e.remoteStore,n))),t._onlineComponents=e}async function bd(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Fo("FirestoreClient","Using user provided OnlineComponentProvider"),await wd(t,t._uninitializedComponentsProvider._online)):(Fo("FirestoreClient","Using default OnlineComponentProvider"),await wd(t,new gd))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=Yl.bind(null,e.syncEngine),n.onUnlisten=td.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Jl.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=ed.bind(null,e.syncEngine),n}function Ed(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Td=new Map;function _d(t){if(la.isDocumentKey(t))throw new Ko(zo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Id(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ko(zo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":jo()}(t);throw new Ko(zo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Sd{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Ko(zo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ko(zo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Ko(zo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ed(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Ko(zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Ko(zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Ko(zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Cd{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ko(zo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Ko(zo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Qo;switch(t.type){case"firstParty":return new Jo(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Ko(zo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Td.get(t);e&&(Fo("ComponentProvider","Removing Datastore"),Td.delete(t),e.terminate())}(this),Promise.resolve()}}class Ad{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Ad(this.firestore,t,this._query)}}class Dd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kd(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Dd(this.firestore,t,this._key)}}class kd extends Ad{constructor(t,e,n){super(t,e,Bc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Dd(this.firestore,null,new la(t))}withConverter(t){return new kd(this.firestore,t,this._path)}}class Nd{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new ul(this,"async_queue_retry"),this.cu=()=>{const t=cl();t&&Fo("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=cl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;const e=cl();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise((()=>{}));const e=new Go;return this.hu((()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.ru.push(t),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!_a(t))throw t;Fo("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(t){const e=this.nu.then((()=>(this._u=!0,t().catch((t=>{this.ou=t,this._u=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Vo("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this._u=!1,t))))));return this.nu=e,e}enqueueAfterDelay(t,e,n){this.lu(),this.uu.indexOf(t)>-1&&(e=0);const r=Rl.createAndSchedule(this,t,e,n,(t=>this.Iu(t)));return this.su.push(r),r}lu(){this.ou&&jo()}verifyOperationInProgress(){}async Tu(){let t;do{t=this.nu,await t}while(t!==this.nu)}Eu(t){for(const e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then((()=>{this.su.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.su)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tu()}))}Au(t){this.uu.push(t)}Iu(t){const e=this.su.indexOf(t);this.su.splice(e,1)}}function xd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Rd extends Cd{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Nd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Od(this),this._firestoreClient.terminate()}}function Od(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Qa(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Ed(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new yd(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Ld{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ld(Ba.fromBase64String(t))}catch(t){throw new Ko(zo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ld(Ba.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Md{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ko(zo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ua(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Pd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ko(zo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ko(zo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ra(this._lat,t._lat)||ra(this._long,t._long)}}const Fd=new RegExp("[~\\*/\\[\\]]");function Vd(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Ko(zo.INVALID_ARGUMENT,a+t+c)}class Ud{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Dd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Bd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(jd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Bd extends Ud{data(){return super.data()}}function jd(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Fd)>=0)throw Vd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Md(...e.split("."))._internalPath}catch(r){throw Vd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Md?e._internalPath:e._delegate._internalPath}class qd{convertValue(t,e="none"){switch(Ya(t)){case 0:return null;case 1:return t.booleanValue;case 2:return $a(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(za(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw jo()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ra(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Pd($a(t.latitude),$a(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ga(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ha(t));default:return null}}convertTimestamp(t){const e=qa(t);return new sa(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ca.fromString(t);qo(Eu(n));const r=new Wa(n.get(1),n.get(3)),i=new la(n.popFirst(5));return r.isEqual(e)||Vo(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class $d{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class zd extends Ud{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Kd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(jd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Kd extends zd{data(t={}){return super.data(t)}}class Gd{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new $d(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Kd(this._firestore,this._userDataWriter,n.key,n,new $d(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ko(zo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Kd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new $d(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Kd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new $d(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Hd(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Hd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jo()}}class Qd extends qd{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ld(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Dd(this.firestore,null,e)}}var Wd;new WeakMap,function(t,e=!0){Lo="10.11.0",xt(new T("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new Rd(new Xo(t.getProvider("auth-internal")),new ta(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ko(zo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wa(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Ft(Ro,"4.6.0",t),Ft(Ro,"4.6.0","esm2017")}(),chrome.identity.getProfileUserInfo({accountStatus:"ANY"},(function(t){Wd=t.email,console.log(Wd),Wd?async function(){try{const t=function(t,e,...n){if(t=E(t),function(t,e,n){if(!n)throw new Ko(zo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof Cd){const r=ca.fromString(e,...n);return _d(r),new kd(t,null,r)}{if(!(t instanceof Dd||t instanceof kd))throw new Ko(zo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ca.fromString(e,...n));return _d(r),new kd(t.firestore,null,r)}}(Yd,Wd);!function(t,...e){var n,r,i;t=E(t);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||xd(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(xd(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,h,u;if(t instanceof Dd)h=Id(t.firestore,Rd),u=Bc(t._key.path),c={next:n=>{e[o]&&e[o](function(t,e,n){const r=n.docs.get(e._key),i=new Qd(t);return new zd(t,i,e._key,r,new $d(n.hasPendingWrites,n.fromCache),e.converter)}(h,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Id(t,Ad);h=Id(n.firestore,Rd),u=n._query;const r=new Qd(h);c={next:t=>{e[o]&&e[o](new Gd(h,r,n,t))},error:e[o+1],complete:e[o+2]},function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Ko(zo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}!function(t,e,n,r){const i=new md(r),s=new zl(e,i,n);t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=$o(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new Fl,r=e.U_()?0:1);try{switch(r){case 0:s.q_=await n.onListen(i,!0);break;case 1:s.q_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=Ol(t,`Initialization of query '${Hc(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.Q_.push(e),e.G_(n.onlineState),s.q_&&e.z_(s.q_)&&jl(n)}(await bd(t),s)))}(function(t){return t._firestoreClient||Od(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(h),u,a,c)}(t,(t=>{var e,n=[];t.forEach((t=>{n.push(t.data())})),e=n,Xd.innerHTML="",e.forEach((t=>{!function(t,e,n,r){let i=document.createElement("tr"),s=document.createElement("td"),o=document.createElement("td"),a=document.createElement("td"),c=document.createElement("td");s.innerHTML=t,o.innerHTML=e,a.innerHTML=n,c.innerHTML=r,i.appendChild(s),i.appendChild(o),i.appendChild(a),i.appendChild(c),Xd.appendChild(i)}(t.companyName,t.date,t.jobTitle,t.status)}))}))}catch(t){console.error("Error in RealTimeData:",t)}}():console.error("Email is empty or undefined.")}));var Xd=document.getElementById("tbody1");!function(t=Pt()){const e=Rt(t=E(t),Pe);e.isInitialized()?e.getImmediate():function(t,e={}){const n=Rt(t,Pe);if(n.isInitialized()){const t=n.getImmediate();if(p(e,n.getOptions()))return t;throw $e.create("already-initialized")}n.initialize({options:e})}(t)}(Mt({apiKey:"AIzaSyD_OG0ZWhO9r8Cv9Csm5QH700kCjGe5MWQ",authDomain:"applify-9f7a9.firebaseapp.com",projectId:"applify-9f7a9",storageBucket:"applify-9f7a9.appspot.com",messagingSenderId:"810543153664",appId:"1:810543153664:web:383acfa1494286ffa28ee5",measurementId:"G-62GSL4N3VZ"}));const Yd=function(t,e){const n=Rt(Pt(),"firestore").getImmediate({identifier:"(default)"});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const o=(t=Id(t,Cd))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Uo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Oo.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Ko(zo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Oo(o)}t._authCredentials=new Wo(new Ho(e,n))}}(n,...t)}return n}()})();